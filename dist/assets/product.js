/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/views/sections/product/product.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/scripts/core/custom-html-element.js":
/*!*************************************************!*\
  !*** ./src/scripts/core/custom-html-element.js ***!
  \*************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/**\n *\n * @param { string } customElemTag\n * @param { class extends HTMLElement } customElmClass\n * @returns customElmClass\n *\n  ----------------------------------------------------------------------\n  USAGE\n  ----------------------------------------------------------------------\n  newCustomElement('custom-element-tag', class extends HTMLElement {\n    constructor () {\n      super()\n      // Your Code Goes Here\n    }\n  })\n  */\nvar newCustomElement = function newCustomElement(customElemTag, customElmClass) {\n  if (typeof window.customElements.get(customElemTag) !== 'undefined') {\n    return null;\n  }\n\n  window.customElements.define(customElemTag, customElmClass);\n  return customElmClass;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (newCustomElement);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9jb3JlL2N1c3RvbS1odG1sLWVsZW1lbnQuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc2NyaXB0cy9jb3JlL2N1c3RvbS1odG1sLWVsZW1lbnQuanM/ZjkxNiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqXG4gKiBAcGFyYW0geyBzdHJpbmcgfSBjdXN0b21FbGVtVGFnXG4gKiBAcGFyYW0geyBjbGFzcyBleHRlbmRzIEhUTUxFbGVtZW50IH0gY3VzdG9tRWxtQ2xhc3NcbiAqIEByZXR1cm5zIGN1c3RvbUVsbUNsYXNzXG4gKlxuICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIFVTQUdFXG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgbmV3Q3VzdG9tRWxlbWVudCgnY3VzdG9tLWVsZW1lbnQtdGFnJywgY2xhc3MgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgc3VwZXIoKVxuICAgICAgLy8gWW91ciBDb2RlIEdvZXMgSGVyZVxuICAgIH1cbiAgfSlcbiAgKi9cbnZhciBuZXdDdXN0b21FbGVtZW50ID0gZnVuY3Rpb24gbmV3Q3VzdG9tRWxlbWVudChjdXN0b21FbGVtVGFnLCBjdXN0b21FbG1DbGFzcykge1xuICBpZiAodHlwZW9mIHdpbmRvdy5jdXN0b21FbGVtZW50cy5nZXQoY3VzdG9tRWxlbVRhZykgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB3aW5kb3cuY3VzdG9tRWxlbWVudHMuZGVmaW5lKGN1c3RvbUVsZW1UYWcsIGN1c3RvbUVsbUNsYXNzKTtcbiAgcmV0dXJuIGN1c3RvbUVsbUNsYXNzO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgbmV3Q3VzdG9tRWxlbWVudDsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/scripts/core/custom-html-element.js\n");

/***/ }),

/***/ "./src/views/sections/product/product.js":
/*!***********************************************!*\
  !*** ./src/views/sections/product/product.js ***!
  \***********************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _product_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./product.scss */ \"./src/views/sections/product/product.scss\");\n/* harmony import */ var _snippets_product_gallery_product_gallery__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @snippets/product-gallery/product-gallery */ \"./src/views/snippets/product-gallery/product-gallery.js\");\n/* harmony import */ var _snippets_back_in_stock_form_back_in_stock_form__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @snippets/back-in-stock-form/back-in-stock-form */ \"./src/views/snippets/back-in-stock-form/back-in-stock-form.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n// Import CSS\n // Snippets\n\n\n\n\n(function () {\n  if (typeof window.customElements.get('product-wrap') !== 'undefined') {\n    return;\n  }\n\n  var ProductWrap = /*#__PURE__*/function (_HTMLElement) {\n    _inherits(ProductWrap, _HTMLElement);\n\n    var _super = _createSuper(ProductWrap);\n\n    function ProductWrap() {\n      var _this;\n\n      _classCallCheck(this, ProductWrap);\n\n      _this = _super.call(this);\n      _this.productSelect = _this.querySelector('[data-product-select]');\n      _this.productPriceEls = _this.querySelectorAll('[data-product-price]');\n      _this.productComparePriceWrapEls = _this.querySelectorAll('[data-product-compare-price-wrap]');\n      _this.productComparePriceEls = _this.querySelectorAll('[data-product-compare-price]');\n      _this.productSubscribeComparePriceEls = _this.querySelectorAll('[data-product-non-subscription-price]');\n      _this.productSubscribePriceEl = _this.querySelector('[data-product-subscribe-price]');\n      _this.sectionId = _this.getAttribute('data-section-id');\n      _this.submitButton = _this.querySelector('[data-product-submit]');\n      _this.submitButtonTextEls = _this.querySelectorAll('[data-product-submit-text]');\n      _this.selectedVariantData = null;\n      _this.selectedVariantSellingPlan = null;\n      _this.isSellingPlanSelected = false;\n      _this.productData = null;\n\n      _this.initProductSection();\n\n      return _this;\n    }\n\n    _createClass(ProductWrap, [{\n      key: \"initProductSection\",\n      value: function () {\n        var _initProductSection = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.prev = 0;\n                  _context.next = 3;\n                  return fetch(\"/products/\".concat(this.dataset.productHandle, \".js\")).then(function (res) {\n                    return res.json();\n                  });\n\n                case 3:\n                  this.productData = _context.sent;\n                  this.associatedProductsInit();\n                  this.productFormInit();\n                  this.productOptionsInit();\n                  this.productGalleriesInit();\n                  _context.next = 13;\n                  break;\n\n                case 10:\n                  _context.prev = 10;\n                  _context.t0 = _context[\"catch\"](0);\n                  console.error(_context.t0);\n\n                case 13:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, this, [[0, 10]]);\n        }));\n\n        function initProductSection() {\n          return _initProductSection.apply(this, arguments);\n        }\n\n        return initProductSection;\n      }()\n    }, {\n      key: \"productFormInit\",\n      value: function productFormInit() {\n        var _this2 = this;\n\n        var currentUrl = new URL(document.location);\n        this.productSelect.addEventListener('change', function () {\n          _this2.getCurrentVariantData();\n\n          _this2.updateProductPrices();\n\n          _this2.updateButtonState();\n\n          currentUrl.searchParams.set('variant', _this2.selectedVariantData.id);\n          window.history.replaceState(null, null, currentUrl.toString());\n        });\n        this.getCurrentVariantData();\n        this.subscriptionOptionsInit();\n      }\n    }, {\n      key: \"updateButtonState\",\n      value: function updateButtonState() {\n        if (!this.submitButton || !this.selectedVariantData) {\n          return;\n        }\n\n        var buttonState = this.selectedVariantData.available ? 'add' : 'sold-out';\n        this.submitButton.disabled = !this.selectedVariantData.available;\n        this.submitButtonTextEls.forEach(function (textEl) {\n          return textEl.classList.toggle('d-none', buttonState !== textEl.dataset.state);\n        });\n      }\n    }, {\n      key: \"associatedProductsInit\",\n      value: function () {\n        var _associatedProductsInit = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n          var _this3 = this;\n\n          var associatedProductToggles, associatedProductEls, sectionPromises, sectionPromisesResults, _iterator, _step, result, response, parser, responseDoc, responseSection;\n\n          return regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  associatedProductToggles = this.querySelectorAll('[data-associated-product-toggle]');\n                  associatedProductEls = document.querySelectorAll(\"[data-section-id=\\\"\".concat(this.sectionId, \"\\\"]\"));\n\n                  if (associatedProductToggles.length) {\n                    _context3.next = 4;\n                    break;\n                  }\n\n                  return _context3.abrupt(\"return\");\n\n                case 4:\n                  if (this.hasAttribute('data-associated-product-section')) {\n                    _context3.next = 38;\n                    break;\n                  }\n\n                  sectionPromises = _toConsumableArray(associatedProductToggles).filter(function (toggle) {\n                    return toggle.dataset.handle !== _this3.dataset.productHandle;\n                  }).map(function (toggle) {\n                    return fetch(\"\".concat(toggle.dataset.url, \"?sections=\").concat(_this3.sectionId));\n                  });\n                  _context3.next = 8;\n                  return Promise.allSettled(sectionPromises);\n\n                case 8:\n                  sectionPromisesResults = _context3.sent;\n                  _iterator = _createForOfIteratorHelper(sectionPromisesResults);\n                  _context3.prev = 10;\n\n                  _iterator.s();\n\n                case 12:\n                  if ((_step = _iterator.n()).done) {\n                    _context3.next = 29;\n                    break;\n                  }\n\n                  result = _step.value;\n\n                  if (!(result.status === 'fulfilled')) {\n                    _context3.next = 26;\n                    break;\n                  }\n\n                  _context3.next = 17;\n                  return result.value.json();\n\n                case 17:\n                  response = _context3.sent;\n                  parser = new window.DOMParser();\n                  responseDoc = parser.parseFromString(response[this.sectionId], 'text/html');\n                  responseSection = responseDoc.querySelector('product-wrap');\n                  responseSection.setAttribute('data-associated-product-section', '');\n                  responseSection.classList.add('hide');\n                  this.insertAdjacentElement('afterend', responseSection);\n                  _context3.next = 27;\n                  break;\n\n                case 26:\n                  console.error(result.value);\n\n                case 27:\n                  _context3.next = 12;\n                  break;\n\n                case 29:\n                  _context3.next = 34;\n                  break;\n\n                case 31:\n                  _context3.prev = 31;\n                  _context3.t0 = _context3[\"catch\"](10);\n\n                  _iterator.e(_context3.t0);\n\n                case 34:\n                  _context3.prev = 34;\n\n                  _iterator.f();\n\n                  return _context3.finish(34);\n\n                case 37:\n                  associatedProductEls = document.querySelectorAll(\"[data-section-id=\\\"\".concat(this.sectionId, \"\\\"]\"));\n\n                case 38:\n                  associatedProductToggles.forEach(function (toggle) {\n                    toggle.addEventListener('change', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n                      var matchingSection, matchingSectionButton, historyUrl;\n                      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                        while (1) {\n                          switch (_context2.prev = _context2.next) {\n                            case 0:\n                              matchingSection = _toConsumableArray(associatedProductEls).find(function (productEl) {\n                                return productEl.dataset.productHandle === toggle.dataset.handle;\n                              });\n\n                              if (matchingSection) {\n                                _context2.next = 3;\n                                break;\n                              }\n\n                              return _context2.abrupt(\"return\");\n\n                            case 3:\n                              associatedProductEls.forEach(function (productEl) {\n                                productEl.classList.toggle('hide', productEl.dataset.productHandle !== toggle.dataset.handle);\n                              });\n                              matchingSectionButton = matchingSection.querySelector(\"[data-associated-product-toggle][data-handle=\\\"\".concat(toggle.dataset.handle, \"\\\"]\"));\n\n                              if (matchingSectionButton) {\n                                matchingSectionButton.checked = true;\n                                matchingSectionButton.focus();\n                              }\n\n                              historyUrl = \"\".concat(toggle.dataset.url).concat(matchingSection !== null && matchingSection !== void 0 && matchingSection.selectedVariantData ? \"?variant=\".concat(matchingSection.selectedVariantData.id) : '');\n                              window.history.replaceState({}, toggle.dataset.title, historyUrl);\n                              window.scrollTo(0, 0);\n\n                            case 9:\n                            case \"end\":\n                              return _context2.stop();\n                          }\n                        }\n                      }, _callee2);\n                    })));\n                  });\n\n                case 39:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3, this, [[10, 31, 34, 37]]);\n        }));\n\n        function associatedProductsInit() {\n          return _associatedProductsInit.apply(this, arguments);\n        }\n\n        return associatedProductsInit;\n      }()\n    }, {\n      key: \"getCurrentVariantData\",\n      value: function getCurrentVariantData() {\n        var variantId = this.productSelect.value;\n        this.selectedVariantData = this.productData.variants.find(function (variant) {\n          return variant.id === Number(variantId);\n        });\n      }\n    }, {\n      key: \"productOptionsInit\",\n      value: function productOptionsInit() {\n        var _this4 = this;\n\n        var optionsParentEl = this.querySelector('[data-product-options]');\n        var optionGroups = this.querySelectorAll('[data-product-option-group]');\n        var optionRadios = this.querySelectorAll('[data-product-option][data-type=\"radio\"]');\n        var variantStockMessage = this.querySelector('[data-variant-stock-message]');\n        var quantitySelectInput = this.querySelector('[data-quantity-input]');\n        var bisEl = this.querySelector('bis-form');\n\n        if (!optionsParentEl || !optionGroups.length) {\n          return;\n        }\n\n        var unavailableDisplay = optionsParentEl.getAttribute('data-unavailable-display');\n\n        var getNextExistingVariant = function getNextExistingVariant(selectedOptions, optionIndex) {\n          var nextVariant = _this4.productData.variants.find(function (variant) {\n            return variant[\"option\".concat(optionIndex)] === selectedOptions[\"option\".concat(optionIndex)];\n          });\n\n          var nextVariantOptions = nextVariant.options.reduce(function (object, option, index) {\n            object[\"option\".concat(index + 1)] = option;\n            return object;\n          }, {});\n          return {\n            nextVariantOptions: nextVariantOptions,\n            nextVariant: nextVariant\n          };\n        };\n\n        var getSelectedOptions = function getSelectedOptions() {\n          var selectedOptions = _toConsumableArray(optionGroups).reduce(function (object, group) {\n            var value = null;\n\n            if (group.dataset.type === 'select') {\n              var select = group.querySelector('[data-product-option]');\n              value = select.value;\n            } else {\n              value = group.querySelector('[data-product-option]:checked').value;\n            }\n\n            object[\"option\".concat(group.dataset.optionIndex)] = value;\n            return object;\n          }, {});\n\n          return selectedOptions;\n        };\n\n        var updateSelectedText = function updateSelectedText(group, input) {\n          optionGroups.forEach(function (optionGroup) {\n            var selectedInput = optionGroup.querySelector('[data-product-option]:checked');\n            var selectedTextEl = optionGroup.querySelector('[data-product-option-group-selected-text]');\n            if (!selectedTextEl || !selectedInput) return;\n            var selectedText = selectedInput.dataset.selectedText;\n            selectedTextEl.textContent = selectedText;\n          });\n        };\n\n        var updateVariantStockMessage = function updateVariantStockMessage(policy, quantity) {\n          var variantQuantity = parseInt(quantity, 10);\n          if (!variantStockMessage) return;\n          variantStockMessage.classList.add('hide');\n\n          if (policy === 'deny' && variantQuantity > 0 && variantQuantity < parseInt(variantStockMessage.dataset.lowStockBreakpoint, 10)) {\n            variantStockMessage.classList.remove('hide');\n          }\n        };\n\n        var updateQuanitySelect = function updateQuanitySelect(selectedVariant) {\n          if (!quantitySelectInput || !selectedVariant) {\n            return;\n          }\n\n          var selectedOption = _this4.productSelect.querySelector(\"option[value=\\\"\".concat(selectedVariant.id, \"\\\"]\"));\n\n          var _selectedOption$datas = selectedOption.dataset,\n              inventoryQuantity = _selectedOption$datas.inventoryQuantity,\n              inventoryPolicy = _selectedOption$datas.inventoryPolicy;\n\n          if (quantitySelectInput.value > inventoryQuantity && inventoryQuantity > 0) {\n            quantitySelectInput.value = inventoryQuantity;\n          }\n\n          var maxValue = inventoryPolicy === 'continue' ? 99 : inventoryQuantity;\n          quantitySelectInput.max = maxValue;\n          updateVariantStockMessage(inventoryPolicy, inventoryQuantity);\n        };\n\n        var updateOptionRadios = function updateOptionRadios(selectedOptions) {\n          optionRadios.forEach(function (optionRadio, index) {\n            var inputOptions = _objectSpread({}, selectedOptions);\n\n            var parentItemEl = optionRadio.closest('[data-product-option-item]');\n            var optionIndex = Number(optionRadio.dataset.optionIndex);\n            inputOptions[\"option\".concat(optionIndex)] = optionRadio.value;\n            var matchingVariant = getVariantByOptions(inputOptions);\n            optionRadio.checked = optionRadio.value === selectedOptions[\"option\".concat(optionIndex)];\n            parentItemEl.classList.toggle('unavailable', !matchingVariant);\n            parentItemEl.classList.toggle('soldout', (matchingVariant === null || matchingVariant === void 0 ? void 0 : matchingVariant.available) === false);\n          });\n        };\n\n        var getVariantByOptions = function getVariantByOptions(options) {\n          var matchingVariant = _this4.productData.variants.find(function (variant) {\n            var isMatch = true;\n\n            for (var _i = 0, _Object$entries = Object.entries(options); _i < _Object$entries.length; _i++) {\n              var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n                  key = _Object$entries$_i[0],\n                  value = _Object$entries$_i[1];\n\n              if (variant[key] !== value) {\n                isMatch = false;\n                break;\n              }\n            }\n\n            return isMatch;\n          });\n\n          return matchingVariant || null;\n        };\n\n        var setAtcButtonUnavailable = function setAtcButtonUnavailable() {\n          if (!_this4.submitButton) {\n            return;\n          }\n\n          var buttonState = 'unavailable';\n          _this4.submitButton.disabled = true;\n\n          _this4.submitButtonTextEls.forEach(function (textEl) {\n            return textEl.classList.toggle('d-none', buttonState !== textEl.dataset.state);\n          });\n        };\n\n        optionGroups.forEach(function (optionGroup) {\n          optionGroup.addEventListener('change', function (event) {\n            handleOptionChange(optionGroup);\n          });\n        });\n\n        var handleOptionChange = function handleOptionChange(group) {\n          var selectedOptions = getSelectedOptions();\n          var selectedVariant = getVariantByOptions(selectedOptions);\n\n          if (!selectedVariant && unavailableDisplay === 'select-next-available') {\n            var nextVariantData = getNextExistingVariant(selectedOptions, group.dataset.optionIndex);\n            selectedOptions = nextVariantData.nextVariantOptions;\n            selectedVariant = nextVariantData.nextVariant;\n          }\n\n          updateOptionRadios(selectedOptions);\n          updateSelectedText();\n          updateQuanitySelect(selectedVariant);\n\n          if (bisEl) {\n            bisEl.handleVariantUpdate(selectedVariant);\n          }\n\n          if (selectedVariant) {\n            _this4.productSelect.value = selectedVariant.id;\n\n            _this4.productSelect.dispatchEvent(new Event('change'));\n          } else {\n            setAtcButtonUnavailable();\n          }\n        };\n\n        handleOptionChange(optionGroups[0]);\n      }\n    }, {\n      key: \"updateProductPrices\",\n      value: function updateProductPrices() {\n        var price = this.selectedVariantData.price;\n        var comparePrice = this.selectedVariantData.compare_at_price;\n\n        if (this.isSellingPlanSelected && this.selectedVariantSellingPlan) {\n          price = this.selectedVariantSellingPlan.price;\n          comparePrice = this.selectedVariantSellingPlan.compare_at_price;\n        } // Base prices\n\n\n        this.productPriceEls.forEach(function (productPriceEl) {\n          productPriceEl.textContent = Shopify.formatMoney(price, theme.moneyFormat);\n        }); // Compare at prices\n\n        this.productComparePriceWrapEls.forEach(function (priceWrapEl) {\n          priceWrapEl.classList.toggle('d-none', !comparePrice || price > comparePrice);\n        });\n        this.productComparePriceEls.forEach(function (priceEl) {\n          priceEl.textContent = Shopify.formatMoney(comparePrice, theme.moneyFormat);\n        });\n      }\n    }, {\n      key: \"subscriptionOptionsInit\",\n      value: function subscriptionOptionsInit() {\n        var _this5 = this;\n\n        var sellingPlansGroupWrap = this.querySelector('[data-product-selling-plan-group-wrap]');\n        var sellingPlansGroupEls = this.querySelectorAll('[data-product-selling-plan-group]');\n\n        if (!sellingPlansGroupEls.length) {\n          return;\n        }\n\n        var subscriptionToggleRadios = this.querySelectorAll('[data-product-subscription-toggle]');\n        var sellingPlanHiddenInput = this.querySelector('[data-product-selling-plan-input]');\n        var currentSellingPlanGroupEl = null;\n        var currentSellingPlanSelect = null;\n        sellingPlansGroupEls.forEach(function (sellingPlansGroupEl) {\n          var sellingPlanSelect = sellingPlansGroupEl.querySelector('[data-product-selling-plans-select]');\n          sellingPlanSelect.addEventListener('change', function () {\n            sellingPlanHiddenInput.value = sellingPlanSelect.value;\n            _this5.selectedVariantSellingPlan = _this5.selectedVariantData.selling_plan_allocations.find(function (allocation) {\n              return allocation.selling_plan_id === Number(sellingPlanSelect.value);\n            });\n\n            _this5.updateProductPrices();\n          });\n        });\n\n        var updateCurrentSellingPlan = function updateCurrentSellingPlan() {\n          var variantSellingPlanGroupIds = _this5.selectedVariantData.selling_plan_allocations.map(function (allocation) {\n            return allocation.selling_plan_group_id;\n          });\n\n          currentSellingPlanGroupEl = _toConsumableArray(sellingPlansGroupEls).find(function (groupEl) {\n            return variantSellingPlanGroupIds.includes(groupEl.dataset.id);\n          });\n          currentSellingPlanSelect = currentSellingPlanGroupEl.querySelector('[data-product-selling-plans-select]');\n          _this5.selectedVariantSellingPlan = _this5.selectedVariantData.selling_plan_allocations.find(function (allocation) {\n            return allocation.selling_plan_id === Number(currentSellingPlanSelect.value);\n          });\n          sellingPlanHiddenInput.value = currentSellingPlanSelect.value;\n        };\n\n        var updateSellingPlanGroups = function updateSellingPlanGroups() {\n          sellingPlansGroupEls.forEach(function (groupEl) {\n            return groupEl.classList.toggle('d-none', groupEl.dataset.id !== _this5.selectedVariantSellingPlan.selling_plan_group_id);\n          });\n        };\n\n        var updateSellingPlanPrices = function updateSellingPlanPrices() {\n          if (!_this5.selectedVariantSellingPlan) {\n            return;\n          }\n\n          _this5.productSubscribeComparePriceEls.forEach(function (priceEl) {\n            priceEl.textContent = Shopify.formatMoney(_this5.selectedVariantData.price);\n          });\n\n          _this5.productSubscribePriceEl.textContent = Shopify.formatMoney(_this5.selectedVariantSellingPlan.price);\n        };\n\n        subscriptionToggleRadios.forEach(function (toggleRadio) {\n          toggleRadio.addEventListener('change', function () {\n            _this5.isSellingPlanSelected = toggleRadio.value === 'subscription';\n            sellingPlansGroupWrap.classList.toggle('d-none', !_this5.isSellingPlanSelected);\n            updateCurrentSellingPlan();\n            updateSellingPlanGroups();\n\n            _this5.updateProductPrices();\n          });\n        });\n        this.productSelect.addEventListener('change', function (event) {\n          updateCurrentSellingPlan();\n          updateSellingPlanGroups();\n          updateSellingPlanPrices();\n\n          _this5.updateProductPrices();\n        });\n      }\n    }, {\n      key: \"productGalleriesInit\",\n      value: function productGalleriesInit() {\n        var _this6 = this;\n\n        var galleryCarousels = this.querySelectorAll('product-gallery-carousel');\n        var gridGallery = this.querySelector('product-gallery-grid');\n        var simpleGallery = this.querySelector('product-gallery-simple');\n        galleryCarousels.forEach(function (carousel) {\n          carousel.selectedVariant = _this6.selectedVariantData;\n        });\n        this.productSelect.addEventListener('change', function () {\n          galleryCarousels.forEach(function (carousel) {\n            carousel.selectedVariant = _this6.selectedVariantData;\n          });\n\n          if (gridGallery) {\n            gridGallery.selectedVariant = _this6.selectedVariantData;\n          }\n\n          if (simpleGallery) {\n            simpleGallery.selectedVariant = _this6.selectedVariantData;\n          }\n        });\n      }\n    }]);\n\n    return ProductWrap;\n  }( /*#__PURE__*/_wrapNativeSuper(HTMLElement));\n\n  window.customElements.define('product-wrap', ProductWrap);\n})();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3Mvc2VjdGlvbnMvcHJvZHVjdC9wcm9kdWN0LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL3ZpZXdzL3NlY3Rpb25zL3Byb2R1Y3QvcHJvZHVjdC5qcz8zZjgzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjsgcmV0dXJuIF90eXBlb2YgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBcInN5bWJvbFwiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9LCBfdHlwZW9mKG9iaik7IH1cblxuZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7IHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7IH1cblxuZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLlwiKTsgfVxuXG5mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7IHZhciBfaSA9IGFyciA9PSBudWxsID8gbnVsbCA6IHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyW1wiQEBpdGVyYXRvclwiXTsgaWYgKF9pID09IG51bGwpIHJldHVybjsgdmFyIF9hcnIgPSBbXTsgdmFyIF9uID0gdHJ1ZTsgdmFyIF9kID0gZmFsc2U7IHZhciBfcywgX2U7IHRyeSB7IGZvciAoX2kgPSBfaS5jYWxsKGFycik7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsgX2Fyci5wdXNoKF9zLnZhbHVlKTsgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOyB9IH0gY2F0Y2ggKGVycikgeyBfZCA9IHRydWU7IF9lID0gZXJyOyB9IGZpbmFsbHkgeyB0cnkgeyBpZiAoIV9uICYmIF9pW1wicmV0dXJuXCJdICE9IG51bGwpIF9pW1wicmV0dXJuXCJdKCk7IH0gZmluYWxseSB7IGlmIChfZCkgdGhyb3cgX2U7IH0gfSByZXR1cm4gX2FycjsgfVxuXG5mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7IH1cblxuZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGVudW1lcmFibGVPbmx5ICYmIChzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSkpLCBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH1cblxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IG51bGwgIT0gYXJndW1lbnRzW2ldID8gYXJndW1lbnRzW2ldIDoge307IGkgJSAyID8gb3duS2V5cyhPYmplY3Qoc291cmNlKSwgITApLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSkgOiBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IHJldHVybiB0YXJnZXQ7IH1cblxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH1cblxuZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHsgdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1tcIkBAaXRlcmF0b3JcIl07IGlmICghaXQpIHsgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgeyBpZiAoaXQpIG8gPSBpdDsgdmFyIGkgPSAwOyB2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTsgcmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHsgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTsgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgdGhyb3cgX2UyOyB9LCBmOiBGIH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpOyB9IHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjsgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsgaXQgPSBpdC5jYWxsKG8pOyB9LCBuOiBmdW5jdGlvbiBuKCkgeyB2YXIgc3RlcCA9IGl0Lm5leHQoKTsgbm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTsgcmV0dXJuIHN0ZXA7IH0sIGU6IGZ1bmN0aW9uIGUoX2UzKSB7IGRpZEVyciA9IHRydWU7IGVyciA9IF9lMzsgfSwgZjogZnVuY3Rpb24gZigpIHsgdHJ5IHsgaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0W1wicmV0dXJuXCJdICE9IG51bGwpIGl0W1wicmV0dXJuXCJdKCk7IH0gZmluYWxseSB7IGlmIChkaWRFcnIpIHRocm93IGVycjsgfSB9IH07IH1cblxuZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7IH1cblxuZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSBcInN0cmluZ1wiKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gXCJPYmplY3RcIiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gXCJNYXBcIiB8fCBuID09PSBcIlNldFwiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09IFwiQXJndW1lbnRzXCIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9XG5cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAodHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBpdGVyW1N5bWJvbC5pdGVyYXRvcl0gIT0gbnVsbCB8fCBpdGVyW1wiQEBpdGVyYXRvclwiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfVxuXG5mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShhcnIpOyB9XG5cbmZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfVxuXG5mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9XG5cbmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwibmV4dFwiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwidGhyb3dcIiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCBcInByb3RvdHlwZVwiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvblwiKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgXCJwcm90b3R5cGVcIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9XG5cbmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikpIHsgcmV0dXJuIGNhbGw7IH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZFwiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfVxuXG5mdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIHNlbGY7IH1cblxuZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykgeyB2YXIgX2NhY2hlID0gdHlwZW9mIE1hcCA9PT0gXCJmdW5jdGlvblwiID8gbmV3IE1hcCgpIDogdW5kZWZpbmVkOyBfd3JhcE5hdGl2ZVN1cGVyID0gZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykgeyBpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzOyBpZiAodHlwZW9mIENsYXNzICE9PSBcImZ1bmN0aW9uXCIpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uXCIpOyB9IGlmICh0eXBlb2YgX2NhY2hlICE9PSBcInVuZGVmaW5lZFwiKSB7IGlmIChfY2FjaGUuaGFzKENsYXNzKSkgcmV0dXJuIF9jYWNoZS5nZXQoQ2xhc3MpOyBfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTsgfSBmdW5jdGlvbiBXcmFwcGVyKCkgeyByZXR1cm4gX2NvbnN0cnVjdChDbGFzcywgYXJndW1lbnRzLCBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpOyB9IFdyYXBwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IFdyYXBwZXIsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IHJldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpOyB9OyByZXR1cm4gX3dyYXBOYXRpdmVTdXBlcihDbGFzcyk7IH1cblxuZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7IGlmIChfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkpIHsgX2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0OyB9IGVsc2UgeyBfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7IHZhciBhID0gW251bGxdOyBhLnB1c2guYXBwbHkoYSwgYXJncyk7IHZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTsgdmFyIGluc3RhbmNlID0gbmV3IENvbnN0cnVjdG9yKCk7IGlmIChDbGFzcykgX3NldFByb3RvdHlwZU9mKGluc3RhbmNlLCBDbGFzcy5wcm90b3R5cGUpOyByZXR1cm4gaW5zdGFuY2U7IH07IH0gcmV0dXJuIF9jb25zdHJ1Y3QuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsgfVxuXG5mdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwidW5kZWZpbmVkXCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIHRydWU7IHRyeSB7IEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTsgcmV0dXJuIHRydWU7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlOyB9IH1cblxuZnVuY3Rpb24gX2lzTmF0aXZlRnVuY3Rpb24oZm4pIHsgcmV0dXJuIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoZm4pLmluZGV4T2YoXCJbbmF0aXZlIGNvZGVdXCIpICE9PSAtMTsgfVxuXG5mdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfVxuXG5mdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9XG5cbi8vIEltcG9ydCBDU1NcbmltcG9ydCAnLi9wcm9kdWN0LnNjc3MnOyAvLyBTbmlwcGV0c1xuXG5pbXBvcnQgJ0BzbmlwcGV0cy9wcm9kdWN0LWdhbGxlcnkvcHJvZHVjdC1nYWxsZXJ5JztcbmltcG9ydCAnQHNuaXBwZXRzL2JhY2staW4tc3RvY2stZm9ybS9iYWNrLWluLXN0b2NrLWZvcm0nO1xuXG4oZnVuY3Rpb24gKCkge1xuICBpZiAodHlwZW9mIHdpbmRvdy5jdXN0b21FbGVtZW50cy5nZXQoJ3Byb2R1Y3Qtd3JhcCcpICE9PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBQcm9kdWN0V3JhcCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0hUTUxFbGVtZW50KSB7XG4gICAgX2luaGVyaXRzKFByb2R1Y3RXcmFwLCBfSFRNTEVsZW1lbnQpO1xuXG4gICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihQcm9kdWN0V3JhcCk7XG5cbiAgICBmdW5jdGlvbiBQcm9kdWN0V3JhcCgpIHtcbiAgICAgIHZhciBfdGhpcztcblxuICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFByb2R1Y3RXcmFwKTtcblxuICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTtcbiAgICAgIF90aGlzLnByb2R1Y3RTZWxlY3QgPSBfdGhpcy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wcm9kdWN0LXNlbGVjdF0nKTtcbiAgICAgIF90aGlzLnByb2R1Y3RQcmljZUVscyA9IF90aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXByb2R1Y3QtcHJpY2VdJyk7XG4gICAgICBfdGhpcy5wcm9kdWN0Q29tcGFyZVByaWNlV3JhcEVscyA9IF90aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXByb2R1Y3QtY29tcGFyZS1wcmljZS13cmFwXScpO1xuICAgICAgX3RoaXMucHJvZHVjdENvbXBhcmVQcmljZUVscyA9IF90aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXByb2R1Y3QtY29tcGFyZS1wcmljZV0nKTtcbiAgICAgIF90aGlzLnByb2R1Y3RTdWJzY3JpYmVDb21wYXJlUHJpY2VFbHMgPSBfdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1wcm9kdWN0LW5vbi1zdWJzY3JpcHRpb24tcHJpY2VdJyk7XG4gICAgICBfdGhpcy5wcm9kdWN0U3Vic2NyaWJlUHJpY2VFbCA9IF90aGlzLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXByb2R1Y3Qtc3Vic2NyaWJlLXByaWNlXScpO1xuICAgICAgX3RoaXMuc2VjdGlvbklkID0gX3RoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXNlY3Rpb24taWQnKTtcbiAgICAgIF90aGlzLnN1Ym1pdEJ1dHRvbiA9IF90aGlzLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXByb2R1Y3Qtc3VibWl0XScpO1xuICAgICAgX3RoaXMuc3VibWl0QnV0dG9uVGV4dEVscyA9IF90aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXByb2R1Y3Qtc3VibWl0LXRleHRdJyk7XG4gICAgICBfdGhpcy5zZWxlY3RlZFZhcmlhbnREYXRhID0gbnVsbDtcbiAgICAgIF90aGlzLnNlbGVjdGVkVmFyaWFudFNlbGxpbmdQbGFuID0gbnVsbDtcbiAgICAgIF90aGlzLmlzU2VsbGluZ1BsYW5TZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgX3RoaXMucHJvZHVjdERhdGEgPSBudWxsO1xuXG4gICAgICBfdGhpcy5pbml0UHJvZHVjdFNlY3Rpb24oKTtcblxuICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cblxuICAgIF9jcmVhdGVDbGFzcyhQcm9kdWN0V3JhcCwgW3tcbiAgICAgIGtleTogXCJpbml0UHJvZHVjdFNlY3Rpb25cIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfaW5pdFByb2R1Y3RTZWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkge1xuICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkge1xuICAgICAgICAgICAgd2hpbGUgKDEpIHtcbiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwO1xuICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2goXCIvcHJvZHVjdHMvXCIuY29uY2F0KHRoaXMuZGF0YXNldC5wcm9kdWN0SGFuZGxlLCBcIi5qc1wiKSkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3REYXRhID0gX2NvbnRleHQuc2VudDtcbiAgICAgICAgICAgICAgICAgIHRoaXMuYXNzb2NpYXRlZFByb2R1Y3RzSW5pdCgpO1xuICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0Rm9ybUluaXQoKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdE9wdGlvbnNJbml0KCk7XG4gICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RHYWxsZXJpZXNJbml0KCk7XG4gICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7XG4gICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTA7XG4gICAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0W1wiY2F0Y2hcIl0oMCk7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKF9jb250ZXh0LnQwKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgICAgY2FzZSBcImVuZFwiOlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMsIFtbMCwgMTBdXSk7XG4gICAgICAgIH0pKTtcblxuICAgICAgICBmdW5jdGlvbiBpbml0UHJvZHVjdFNlY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF9pbml0UHJvZHVjdFNlY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpbml0UHJvZHVjdFNlY3Rpb247XG4gICAgICB9KClcbiAgICB9LCB7XG4gICAgICBrZXk6IFwicHJvZHVjdEZvcm1Jbml0XCIsXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gcHJvZHVjdEZvcm1Jbml0KCkge1xuICAgICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgICB2YXIgY3VycmVudFVybCA9IG5ldyBVUkwoZG9jdW1lbnQubG9jYXRpb24pO1xuICAgICAgICB0aGlzLnByb2R1Y3RTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIF90aGlzMi5nZXRDdXJyZW50VmFyaWFudERhdGEoKTtcblxuICAgICAgICAgIF90aGlzMi51cGRhdGVQcm9kdWN0UHJpY2VzKCk7XG5cbiAgICAgICAgICBfdGhpczIudXBkYXRlQnV0dG9uU3RhdGUoKTtcblxuICAgICAgICAgIGN1cnJlbnRVcmwuc2VhcmNoUGFyYW1zLnNldCgndmFyaWFudCcsIF90aGlzMi5zZWxlY3RlZFZhcmlhbnREYXRhLmlkKTtcbiAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgbnVsbCwgY3VycmVudFVybC50b1N0cmluZygpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ2V0Q3VycmVudFZhcmlhbnREYXRhKCk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uT3B0aW9uc0luaXQoKTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICBrZXk6IFwidXBkYXRlQnV0dG9uU3RhdGVcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCdXR0b25TdGF0ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN1Ym1pdEJ1dHRvbiB8fCAhdGhpcy5zZWxlY3RlZFZhcmlhbnREYXRhKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGJ1dHRvblN0YXRlID0gdGhpcy5zZWxlY3RlZFZhcmlhbnREYXRhLmF2YWlsYWJsZSA/ICdhZGQnIDogJ3NvbGQtb3V0JztcbiAgICAgICAgdGhpcy5zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSAhdGhpcy5zZWxlY3RlZFZhcmlhbnREYXRhLmF2YWlsYWJsZTtcbiAgICAgICAgdGhpcy5zdWJtaXRCdXR0b25UZXh0RWxzLmZvckVhY2goZnVuY3Rpb24gKHRleHRFbCkge1xuICAgICAgICAgIHJldHVybiB0ZXh0RWwuY2xhc3NMaXN0LnRvZ2dsZSgnZC1ub25lJywgYnV0dG9uU3RhdGUgIT09IHRleHRFbC5kYXRhc2V0LnN0YXRlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcImFzc29jaWF0ZWRQcm9kdWN0c0luaXRcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfYXNzb2NpYXRlZFByb2R1Y3RzSW5pdCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7XG4gICAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgICAgICB2YXIgYXNzb2NpYXRlZFByb2R1Y3RUb2dnbGVzLCBhc3NvY2lhdGVkUHJvZHVjdEVscywgc2VjdGlvblByb21pc2VzLCBzZWN0aW9uUHJvbWlzZXNSZXN1bHRzLCBfaXRlcmF0b3IsIF9zdGVwLCByZXN1bHQsIHJlc3BvbnNlLCBwYXJzZXIsIHJlc3BvbnNlRG9jLCByZXNwb25zZVNlY3Rpb247XG5cbiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0Mykge1xuICAgICAgICAgICAgd2hpbGUgKDEpIHtcbiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgYXNzb2NpYXRlZFByb2R1Y3RUb2dnbGVzID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1hc3NvY2lhdGVkLXByb2R1Y3QtdG9nZ2xlXScpO1xuICAgICAgICAgICAgICAgICAgYXNzb2NpYXRlZFByb2R1Y3RFbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtc2VjdGlvbi1pZD1cXFwiXCIuY29uY2F0KHRoaXMuc2VjdGlvbklkLCBcIlxcXCJdXCIpKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKGFzc29jaWF0ZWRQcm9kdWN0VG9nZ2xlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoXCJyZXR1cm5cIik7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoJ2RhdGEtYXNzb2NpYXRlZC1wcm9kdWN0LXNlY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM4O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgc2VjdGlvblByb21pc2VzID0gX3RvQ29uc3VtYWJsZUFycmF5KGFzc29jaWF0ZWRQcm9kdWN0VG9nZ2xlcykuZmlsdGVyKGZ1bmN0aW9uICh0b2dnbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvZ2dsZS5kYXRhc2V0LmhhbmRsZSAhPT0gX3RoaXMzLmRhdGFzZXQucHJvZHVjdEhhbmRsZTtcbiAgICAgICAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAodG9nZ2xlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaChcIlwiLmNvbmNhdCh0b2dnbGUuZGF0YXNldC51cmwsIFwiP3NlY3Rpb25zPVwiKS5jb25jYXQoX3RoaXMzLnNlY3Rpb25JZCkpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDg7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGxTZXR0bGVkKHNlY3Rpb25Qcm9taXNlcyk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICBzZWN0aW9uUHJvbWlzZXNSZXN1bHRzID0gX2NvbnRleHQzLnNlbnQ7XG4gICAgICAgICAgICAgICAgICBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihzZWN0aW9uUHJvbWlzZXNSZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMTA7XG5cbiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvci5zKCk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgICAgaWYgKChfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9zdGVwLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoIShyZXN1bHQuc3RhdHVzID09PSAnZnVsZmlsbGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyNjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTc7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LnZhbHVlLmpzb24oKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0My5zZW50O1xuICAgICAgICAgICAgICAgICAgcGFyc2VyID0gbmV3IHdpbmRvdy5ET01QYXJzZXIoKTtcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlRG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhyZXNwb25zZVt0aGlzLnNlY3Rpb25JZF0sICd0ZXh0L2h0bWwnKTtcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlU2VjdGlvbiA9IHJlc3BvbnNlRG9jLnF1ZXJ5U2VsZWN0b3IoJ3Byb2R1Y3Qtd3JhcCcpO1xuICAgICAgICAgICAgICAgICAgcmVzcG9uc2VTZWN0aW9uLnNldEF0dHJpYnV0ZSgnZGF0YS1hc3NvY2lhdGVkLXByb2R1Y3Qtc2VjdGlvbicsICcnKTtcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlU2VjdGlvbi5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgICB0aGlzLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJlbmQnLCByZXNwb25zZVNlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyNztcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAyNjpcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdWx0LnZhbHVlKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgMjc6XG4gICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDI5OlxuICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzNDtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAzMTpcbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMzE7XG4gICAgICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbXCJjYXRjaFwiXSgxMCk7XG5cbiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvci5lKF9jb250ZXh0My50MCk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDM0OlxuICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAzNDtcblxuICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTtcblxuICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5maW5pc2goMzQpO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAzNzpcbiAgICAgICAgICAgICAgICAgIGFzc29jaWF0ZWRQcm9kdWN0RWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLXNlY3Rpb24taWQ9XFxcIlwiLmNvbmNhdCh0aGlzLnNlY3Rpb25JZCwgXCJcXFwiXVwiKSk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDM4OlxuICAgICAgICAgICAgICAgICAgYXNzb2NpYXRlZFByb2R1Y3RUb2dnbGVzLmZvckVhY2goZnVuY3Rpb24gKHRvZ2dsZSkge1xuICAgICAgICAgICAgICAgICAgICB0b2dnbGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoaW5nU2VjdGlvbiwgbWF0Y2hpbmdTZWN0aW9uQnV0dG9uLCBoaXN0b3J5VXJsO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGluZ1NlY3Rpb24gPSBfdG9Db25zdW1hYmxlQXJyYXkoYXNzb2NpYXRlZFByb2R1Y3RFbHMpLmZpbmQoZnVuY3Rpb24gKHByb2R1Y3RFbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvZHVjdEVsLmRhdGFzZXQucHJvZHVjdEhhbmRsZSA9PT0gdG9nZ2xlLmRhdGFzZXQuaGFuZGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGluZ1NlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoXCJyZXR1cm5cIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NvY2lhdGVkUHJvZHVjdEVscy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9kdWN0RWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEVsLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGUnLCBwcm9kdWN0RWwuZGF0YXNldC5wcm9kdWN0SGFuZGxlICE9PSB0b2dnbGUuZGF0YXNldC5oYW5kbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGluZ1NlY3Rpb25CdXR0b24gPSBtYXRjaGluZ1NlY3Rpb24ucXVlcnlTZWxlY3RvcihcIltkYXRhLWFzc29jaWF0ZWQtcHJvZHVjdC10b2dnbGVdW2RhdGEtaGFuZGxlPVxcXCJcIi5jb25jYXQodG9nZ2xlLmRhdGFzZXQuaGFuZGxlLCBcIlxcXCJdXCIpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoaW5nU2VjdGlvbkJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGluZ1NlY3Rpb25CdXR0b24uY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoaW5nU2VjdGlvbkJ1dHRvbi5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5VXJsID0gXCJcIi5jb25jYXQodG9nZ2xlLmRhdGFzZXQudXJsKS5jb25jYXQobWF0Y2hpbmdTZWN0aW9uICE9PSBudWxsICYmIG1hdGNoaW5nU2VjdGlvbiAhPT0gdm9pZCAwICYmIG1hdGNoaW5nU2VjdGlvbi5zZWxlY3RlZFZhcmlhbnREYXRhID8gXCI/dmFyaWFudD1cIi5jb25jYXQobWF0Y2hpbmdTZWN0aW9uLnNlbGVjdGVkVmFyaWFudERhdGEuaWQpIDogJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCB0b2dnbGUuZGF0YXNldC50aXRsZSwgaGlzdG9yeVVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImVuZFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7XG4gICAgICAgICAgICAgICAgICAgIH0pKSk7XG4gICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhc2UgMzk6XG4gICAgICAgICAgICAgICAgY2FzZSBcImVuZFwiOlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcywgW1sxMCwgMzEsIDM0LCAzN11dKTtcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGFzc29jaWF0ZWRQcm9kdWN0c0luaXQoKSB7XG4gICAgICAgICAgcmV0dXJuIF9hc3NvY2lhdGVkUHJvZHVjdHNJbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXNzb2NpYXRlZFByb2R1Y3RzSW5pdDtcbiAgICAgIH0oKVxuICAgIH0sIHtcbiAgICAgIGtleTogXCJnZXRDdXJyZW50VmFyaWFudERhdGFcIixcbiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDdXJyZW50VmFyaWFudERhdGEoKSB7XG4gICAgICAgIHZhciB2YXJpYW50SWQgPSB0aGlzLnByb2R1Y3RTZWxlY3QudmFsdWU7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWYXJpYW50RGF0YSA9IHRoaXMucHJvZHVjdERhdGEudmFyaWFudHMuZmluZChmdW5jdGlvbiAodmFyaWFudCkge1xuICAgICAgICAgIHJldHVybiB2YXJpYW50LmlkID09PSBOdW1iZXIodmFyaWFudElkKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcInByb2R1Y3RPcHRpb25zSW5pdFwiLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHByb2R1Y3RPcHRpb25zSW5pdCgpIHtcbiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICAgICAgdmFyIG9wdGlvbnNQYXJlbnRFbCA9IHRoaXMucXVlcnlTZWxlY3RvcignW2RhdGEtcHJvZHVjdC1vcHRpb25zXScpO1xuICAgICAgICB2YXIgb3B0aW9uR3JvdXBzID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1wcm9kdWN0LW9wdGlvbi1ncm91cF0nKTtcbiAgICAgICAgdmFyIG9wdGlvblJhZGlvcyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtcHJvZHVjdC1vcHRpb25dW2RhdGEtdHlwZT1cInJhZGlvXCJdJyk7XG4gICAgICAgIHZhciB2YXJpYW50U3RvY2tNZXNzYWdlID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdbZGF0YS12YXJpYW50LXN0b2NrLW1lc3NhZ2VdJyk7XG4gICAgICAgIHZhciBxdWFudGl0eVNlbGVjdElucHV0ID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1xdWFudGl0eS1pbnB1dF0nKTtcbiAgICAgICAgdmFyIGJpc0VsID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdiaXMtZm9ybScpO1xuXG4gICAgICAgIGlmICghb3B0aW9uc1BhcmVudEVsIHx8ICFvcHRpb25Hcm91cHMubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHVuYXZhaWxhYmxlRGlzcGxheSA9IG9wdGlvbnNQYXJlbnRFbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdW5hdmFpbGFibGUtZGlzcGxheScpO1xuXG4gICAgICAgIHZhciBnZXROZXh0RXhpc3RpbmdWYXJpYW50ID0gZnVuY3Rpb24gZ2V0TmV4dEV4aXN0aW5nVmFyaWFudChzZWxlY3RlZE9wdGlvbnMsIG9wdGlvbkluZGV4KSB7XG4gICAgICAgICAgdmFyIG5leHRWYXJpYW50ID0gX3RoaXM0LnByb2R1Y3REYXRhLnZhcmlhbnRzLmZpbmQoZnVuY3Rpb24gKHZhcmlhbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB2YXJpYW50W1wib3B0aW9uXCIuY29uY2F0KG9wdGlvbkluZGV4KV0gPT09IHNlbGVjdGVkT3B0aW9uc1tcIm9wdGlvblwiLmNvbmNhdChvcHRpb25JbmRleCldO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdmFyIG5leHRWYXJpYW50T3B0aW9ucyA9IG5leHRWYXJpYW50Lm9wdGlvbnMucmVkdWNlKGZ1bmN0aW9uIChvYmplY3QsIG9wdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgICAgIG9iamVjdFtcIm9wdGlvblwiLmNvbmNhdChpbmRleCArIDEpXSA9IG9wdGlvbjtcbiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICAgICAgfSwge30pO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZXh0VmFyaWFudE9wdGlvbnM6IG5leHRWYXJpYW50T3B0aW9ucyxcbiAgICAgICAgICAgIG5leHRWYXJpYW50OiBuZXh0VmFyaWFudFxuICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFNlbGVjdGVkT3B0aW9ucyA9IGZ1bmN0aW9uIGdldFNlbGVjdGVkT3B0aW9ucygpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWRPcHRpb25zID0gX3RvQ29uc3VtYWJsZUFycmF5KG9wdGlvbkdyb3VwcykucmVkdWNlKGZ1bmN0aW9uIChvYmplY3QsIGdyb3VwKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoZ3JvdXAuZGF0YXNldC50eXBlID09PSAnc2VsZWN0Jykge1xuICAgICAgICAgICAgICB2YXIgc2VsZWN0ID0gZ3JvdXAucXVlcnlTZWxlY3RvcignW2RhdGEtcHJvZHVjdC1vcHRpb25dJyk7XG4gICAgICAgICAgICAgIHZhbHVlID0gc2VsZWN0LnZhbHVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBncm91cC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wcm9kdWN0LW9wdGlvbl06Y2hlY2tlZCcpLnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvYmplY3RbXCJvcHRpb25cIi5jb25jYXQoZ3JvdXAuZGF0YXNldC5vcHRpb25JbmRleCldID0gdmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICAgIH0sIHt9KTtcblxuICAgICAgICAgIHJldHVybiBzZWxlY3RlZE9wdGlvbnM7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHVwZGF0ZVNlbGVjdGVkVGV4dCA9IGZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGVkVGV4dChncm91cCwgaW5wdXQpIHtcbiAgICAgICAgICBvcHRpb25Hcm91cHMuZm9yRWFjaChmdW5jdGlvbiAob3B0aW9uR3JvdXApIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZElucHV0ID0gb3B0aW9uR3JvdXAucXVlcnlTZWxlY3RvcignW2RhdGEtcHJvZHVjdC1vcHRpb25dOmNoZWNrZWQnKTtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZFRleHRFbCA9IG9wdGlvbkdyb3VwLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXByb2R1Y3Qtb3B0aW9uLWdyb3VwLXNlbGVjdGVkLXRleHRdJyk7XG4gICAgICAgICAgICBpZiAoIXNlbGVjdGVkVGV4dEVsIHx8ICFzZWxlY3RlZElucHV0KSByZXR1cm47XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRUZXh0ID0gc2VsZWN0ZWRJbnB1dC5kYXRhc2V0LnNlbGVjdGVkVGV4dDtcbiAgICAgICAgICAgIHNlbGVjdGVkVGV4dEVsLnRleHRDb250ZW50ID0gc2VsZWN0ZWRUZXh0O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB1cGRhdGVWYXJpYW50U3RvY2tNZXNzYWdlID0gZnVuY3Rpb24gdXBkYXRlVmFyaWFudFN0b2NrTWVzc2FnZShwb2xpY3ksIHF1YW50aXR5KSB7XG4gICAgICAgICAgdmFyIHZhcmlhbnRRdWFudGl0eSA9IHBhcnNlSW50KHF1YW50aXR5LCAxMCk7XG4gICAgICAgICAgaWYgKCF2YXJpYW50U3RvY2tNZXNzYWdlKSByZXR1cm47XG4gICAgICAgICAgdmFyaWFudFN0b2NrTWVzc2FnZS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG5cbiAgICAgICAgICBpZiAocG9saWN5ID09PSAnZGVueScgJiYgdmFyaWFudFF1YW50aXR5ID4gMCAmJiB2YXJpYW50UXVhbnRpdHkgPCBwYXJzZUludCh2YXJpYW50U3RvY2tNZXNzYWdlLmRhdGFzZXQubG93U3RvY2tCcmVha3BvaW50LCAxMCkpIHtcbiAgICAgICAgICAgIHZhcmlhbnRTdG9ja01lc3NhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdXBkYXRlUXVhbml0eVNlbGVjdCA9IGZ1bmN0aW9uIHVwZGF0ZVF1YW5pdHlTZWxlY3Qoc2VsZWN0ZWRWYXJpYW50KSB7XG4gICAgICAgICAgaWYgKCFxdWFudGl0eVNlbGVjdElucHV0IHx8ICFzZWxlY3RlZFZhcmlhbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgc2VsZWN0ZWRPcHRpb24gPSBfdGhpczQucHJvZHVjdFNlbGVjdC5xdWVyeVNlbGVjdG9yKFwib3B0aW9uW3ZhbHVlPVxcXCJcIi5jb25jYXQoc2VsZWN0ZWRWYXJpYW50LmlkLCBcIlxcXCJdXCIpKTtcblxuICAgICAgICAgIHZhciBfc2VsZWN0ZWRPcHRpb24kZGF0YXMgPSBzZWxlY3RlZE9wdGlvbi5kYXRhc2V0LFxuICAgICAgICAgICAgICBpbnZlbnRvcnlRdWFudGl0eSA9IF9zZWxlY3RlZE9wdGlvbiRkYXRhcy5pbnZlbnRvcnlRdWFudGl0eSxcbiAgICAgICAgICAgICAgaW52ZW50b3J5UG9saWN5ID0gX3NlbGVjdGVkT3B0aW9uJGRhdGFzLmludmVudG9yeVBvbGljeTtcblxuICAgICAgICAgIGlmIChxdWFudGl0eVNlbGVjdElucHV0LnZhbHVlID4gaW52ZW50b3J5UXVhbnRpdHkgJiYgaW52ZW50b3J5UXVhbnRpdHkgPiAwKSB7XG4gICAgICAgICAgICBxdWFudGl0eVNlbGVjdElucHV0LnZhbHVlID0gaW52ZW50b3J5UXVhbnRpdHk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIG1heFZhbHVlID0gaW52ZW50b3J5UG9saWN5ID09PSAnY29udGludWUnID8gOTkgOiBpbnZlbnRvcnlRdWFudGl0eTtcbiAgICAgICAgICBxdWFudGl0eVNlbGVjdElucHV0Lm1heCA9IG1heFZhbHVlO1xuICAgICAgICAgIHVwZGF0ZVZhcmlhbnRTdG9ja01lc3NhZ2UoaW52ZW50b3J5UG9saWN5LCBpbnZlbnRvcnlRdWFudGl0eSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHVwZGF0ZU9wdGlvblJhZGlvcyA9IGZ1bmN0aW9uIHVwZGF0ZU9wdGlvblJhZGlvcyhzZWxlY3RlZE9wdGlvbnMpIHtcbiAgICAgICAgICBvcHRpb25SYWRpb3MuZm9yRWFjaChmdW5jdGlvbiAob3B0aW9uUmFkaW8sIGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgaW5wdXRPcHRpb25zID0gX29iamVjdFNwcmVhZCh7fSwgc2VsZWN0ZWRPcHRpb25zKTtcblxuICAgICAgICAgICAgdmFyIHBhcmVudEl0ZW1FbCA9IG9wdGlvblJhZGlvLmNsb3Nlc3QoJ1tkYXRhLXByb2R1Y3Qtb3B0aW9uLWl0ZW1dJyk7XG4gICAgICAgICAgICB2YXIgb3B0aW9uSW5kZXggPSBOdW1iZXIob3B0aW9uUmFkaW8uZGF0YXNldC5vcHRpb25JbmRleCk7XG4gICAgICAgICAgICBpbnB1dE9wdGlvbnNbXCJvcHRpb25cIi5jb25jYXQob3B0aW9uSW5kZXgpXSA9IG9wdGlvblJhZGlvLnZhbHVlO1xuICAgICAgICAgICAgdmFyIG1hdGNoaW5nVmFyaWFudCA9IGdldFZhcmlhbnRCeU9wdGlvbnMoaW5wdXRPcHRpb25zKTtcbiAgICAgICAgICAgIG9wdGlvblJhZGlvLmNoZWNrZWQgPSBvcHRpb25SYWRpby52YWx1ZSA9PT0gc2VsZWN0ZWRPcHRpb25zW1wib3B0aW9uXCIuY29uY2F0KG9wdGlvbkluZGV4KV07XG4gICAgICAgICAgICBwYXJlbnRJdGVtRWwuY2xhc3NMaXN0LnRvZ2dsZSgndW5hdmFpbGFibGUnLCAhbWF0Y2hpbmdWYXJpYW50KTtcbiAgICAgICAgICAgIHBhcmVudEl0ZW1FbC5jbGFzc0xpc3QudG9nZ2xlKCdzb2xkb3V0JywgKG1hdGNoaW5nVmFyaWFudCA9PT0gbnVsbCB8fCBtYXRjaGluZ1ZhcmlhbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoaW5nVmFyaWFudC5hdmFpbGFibGUpID09PSBmYWxzZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFZhcmlhbnRCeU9wdGlvbnMgPSBmdW5jdGlvbiBnZXRWYXJpYW50QnlPcHRpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgICB2YXIgbWF0Y2hpbmdWYXJpYW50ID0gX3RoaXM0LnByb2R1Y3REYXRhLnZhcmlhbnRzLmZpbmQoZnVuY3Rpb24gKHZhcmlhbnQpIHtcbiAgICAgICAgICAgIHZhciBpc01hdGNoID0gdHJ1ZTtcblxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfT2JqZWN0JGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhvcHRpb25zKTsgX2kgPCBfT2JqZWN0JGVudHJpZXMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgIHZhciBfT2JqZWN0JGVudHJpZXMkX2kgPSBfc2xpY2VkVG9BcnJheShfT2JqZWN0JGVudHJpZXNbX2ldLCAyKSxcbiAgICAgICAgICAgICAgICAgIGtleSA9IF9PYmplY3QkZW50cmllcyRfaVswXSxcbiAgICAgICAgICAgICAgICAgIHZhbHVlID0gX09iamVjdCRlbnRyaWVzJF9pWzFdO1xuXG4gICAgICAgICAgICAgIGlmICh2YXJpYW50W2tleV0gIT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaXNNYXRjaCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBpc01hdGNoO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIG1hdGNoaW5nVmFyaWFudCB8fCBudWxsO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXRBdGNCdXR0b25VbmF2YWlsYWJsZSA9IGZ1bmN0aW9uIHNldEF0Y0J1dHRvblVuYXZhaWxhYmxlKCkge1xuICAgICAgICAgIGlmICghX3RoaXM0LnN1Ym1pdEJ1dHRvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBidXR0b25TdGF0ZSA9ICd1bmF2YWlsYWJsZSc7XG4gICAgICAgICAgX3RoaXM0LnN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgICAgICBfdGhpczQuc3VibWl0QnV0dG9uVGV4dEVscy5mb3JFYWNoKGZ1bmN0aW9uICh0ZXh0RWwpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0RWwuY2xhc3NMaXN0LnRvZ2dsZSgnZC1ub25lJywgYnV0dG9uU3RhdGUgIT09IHRleHRFbC5kYXRhc2V0LnN0YXRlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBvcHRpb25Hcm91cHMuZm9yRWFjaChmdW5jdGlvbiAob3B0aW9uR3JvdXApIHtcbiAgICAgICAgICBvcHRpb25Hcm91cC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGhhbmRsZU9wdGlvbkNoYW5nZShvcHRpb25Hcm91cCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBoYW5kbGVPcHRpb25DaGFuZ2UgPSBmdW5jdGlvbiBoYW5kbGVPcHRpb25DaGFuZ2UoZ3JvdXApIHtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWRPcHRpb25zID0gZ2V0U2VsZWN0ZWRPcHRpb25zKCk7XG4gICAgICAgICAgdmFyIHNlbGVjdGVkVmFyaWFudCA9IGdldFZhcmlhbnRCeU9wdGlvbnMoc2VsZWN0ZWRPcHRpb25zKTtcblxuICAgICAgICAgIGlmICghc2VsZWN0ZWRWYXJpYW50ICYmIHVuYXZhaWxhYmxlRGlzcGxheSA9PT0gJ3NlbGVjdC1uZXh0LWF2YWlsYWJsZScpIHtcbiAgICAgICAgICAgIHZhciBuZXh0VmFyaWFudERhdGEgPSBnZXROZXh0RXhpc3RpbmdWYXJpYW50KHNlbGVjdGVkT3B0aW9ucywgZ3JvdXAuZGF0YXNldC5vcHRpb25JbmRleCk7XG4gICAgICAgICAgICBzZWxlY3RlZE9wdGlvbnMgPSBuZXh0VmFyaWFudERhdGEubmV4dFZhcmlhbnRPcHRpb25zO1xuICAgICAgICAgICAgc2VsZWN0ZWRWYXJpYW50ID0gbmV4dFZhcmlhbnREYXRhLm5leHRWYXJpYW50O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHVwZGF0ZU9wdGlvblJhZGlvcyhzZWxlY3RlZE9wdGlvbnMpO1xuICAgICAgICAgIHVwZGF0ZVNlbGVjdGVkVGV4dCgpO1xuICAgICAgICAgIHVwZGF0ZVF1YW5pdHlTZWxlY3Qoc2VsZWN0ZWRWYXJpYW50KTtcblxuICAgICAgICAgIGlmIChiaXNFbCkge1xuICAgICAgICAgICAgYmlzRWwuaGFuZGxlVmFyaWFudFVwZGF0ZShzZWxlY3RlZFZhcmlhbnQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChzZWxlY3RlZFZhcmlhbnQpIHtcbiAgICAgICAgICAgIF90aGlzNC5wcm9kdWN0U2VsZWN0LnZhbHVlID0gc2VsZWN0ZWRWYXJpYW50LmlkO1xuXG4gICAgICAgICAgICBfdGhpczQucHJvZHVjdFNlbGVjdC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRBdGNCdXR0b25VbmF2YWlsYWJsZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBoYW5kbGVPcHRpb25DaGFuZ2Uob3B0aW9uR3JvdXBzWzBdKTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICBrZXk6IFwidXBkYXRlUHJvZHVjdFByaWNlc1wiLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVByb2R1Y3RQcmljZXMoKSB7XG4gICAgICAgIHZhciBwcmljZSA9IHRoaXMuc2VsZWN0ZWRWYXJpYW50RGF0YS5wcmljZTtcbiAgICAgICAgdmFyIGNvbXBhcmVQcmljZSA9IHRoaXMuc2VsZWN0ZWRWYXJpYW50RGF0YS5jb21wYXJlX2F0X3ByaWNlO1xuXG4gICAgICAgIGlmICh0aGlzLmlzU2VsbGluZ1BsYW5TZWxlY3RlZCAmJiB0aGlzLnNlbGVjdGVkVmFyaWFudFNlbGxpbmdQbGFuKSB7XG4gICAgICAgICAgcHJpY2UgPSB0aGlzLnNlbGVjdGVkVmFyaWFudFNlbGxpbmdQbGFuLnByaWNlO1xuICAgICAgICAgIGNvbXBhcmVQcmljZSA9IHRoaXMuc2VsZWN0ZWRWYXJpYW50U2VsbGluZ1BsYW4uY29tcGFyZV9hdF9wcmljZTtcbiAgICAgICAgfSAvLyBCYXNlIHByaWNlc1xuXG5cbiAgICAgICAgdGhpcy5wcm9kdWN0UHJpY2VFbHMuZm9yRWFjaChmdW5jdGlvbiAocHJvZHVjdFByaWNlRWwpIHtcbiAgICAgICAgICBwcm9kdWN0UHJpY2VFbC50ZXh0Q29udGVudCA9IFNob3BpZnkuZm9ybWF0TW9uZXkocHJpY2UsIHRoZW1lLm1vbmV5Rm9ybWF0KTtcbiAgICAgICAgfSk7IC8vIENvbXBhcmUgYXQgcHJpY2VzXG5cbiAgICAgICAgdGhpcy5wcm9kdWN0Q29tcGFyZVByaWNlV3JhcEVscy5mb3JFYWNoKGZ1bmN0aW9uIChwcmljZVdyYXBFbCkge1xuICAgICAgICAgIHByaWNlV3JhcEVsLmNsYXNzTGlzdC50b2dnbGUoJ2Qtbm9uZScsICFjb21wYXJlUHJpY2UgfHwgcHJpY2UgPiBjb21wYXJlUHJpY2UpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcm9kdWN0Q29tcGFyZVByaWNlRWxzLmZvckVhY2goZnVuY3Rpb24gKHByaWNlRWwpIHtcbiAgICAgICAgICBwcmljZUVsLnRleHRDb250ZW50ID0gU2hvcGlmeS5mb3JtYXRNb25leShjb21wYXJlUHJpY2UsIHRoZW1lLm1vbmV5Rm9ybWF0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcInN1YnNjcmlwdGlvbk9wdGlvbnNJbml0XCIsXG4gICAgICB2YWx1ZTogZnVuY3Rpb24gc3Vic2NyaXB0aW9uT3B0aW9uc0luaXQoKSB7XG4gICAgICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgICAgIHZhciBzZWxsaW5nUGxhbnNHcm91cFdyYXAgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXByb2R1Y3Qtc2VsbGluZy1wbGFuLWdyb3VwLXdyYXBdJyk7XG4gICAgICAgIHZhciBzZWxsaW5nUGxhbnNHcm91cEVscyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtcHJvZHVjdC1zZWxsaW5nLXBsYW4tZ3JvdXBdJyk7XG5cbiAgICAgICAgaWYgKCFzZWxsaW5nUGxhbnNHcm91cEVscy5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc3Vic2NyaXB0aW9uVG9nZ2xlUmFkaW9zID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1wcm9kdWN0LXN1YnNjcmlwdGlvbi10b2dnbGVdJyk7XG4gICAgICAgIHZhciBzZWxsaW5nUGxhbkhpZGRlbklucHV0ID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wcm9kdWN0LXNlbGxpbmctcGxhbi1pbnB1dF0nKTtcbiAgICAgICAgdmFyIGN1cnJlbnRTZWxsaW5nUGxhbkdyb3VwRWwgPSBudWxsO1xuICAgICAgICB2YXIgY3VycmVudFNlbGxpbmdQbGFuU2VsZWN0ID0gbnVsbDtcbiAgICAgICAgc2VsbGluZ1BsYW5zR3JvdXBFbHMuZm9yRWFjaChmdW5jdGlvbiAoc2VsbGluZ1BsYW5zR3JvdXBFbCkge1xuICAgICAgICAgIHZhciBzZWxsaW5nUGxhblNlbGVjdCA9IHNlbGxpbmdQbGFuc0dyb3VwRWwucXVlcnlTZWxlY3RvcignW2RhdGEtcHJvZHVjdC1zZWxsaW5nLXBsYW5zLXNlbGVjdF0nKTtcbiAgICAgICAgICBzZWxsaW5nUGxhblNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxsaW5nUGxhbkhpZGRlbklucHV0LnZhbHVlID0gc2VsbGluZ1BsYW5TZWxlY3QudmFsdWU7XG4gICAgICAgICAgICBfdGhpczUuc2VsZWN0ZWRWYXJpYW50U2VsbGluZ1BsYW4gPSBfdGhpczUuc2VsZWN0ZWRWYXJpYW50RGF0YS5zZWxsaW5nX3BsYW5fYWxsb2NhdGlvbnMuZmluZChmdW5jdGlvbiAoYWxsb2NhdGlvbikge1xuICAgICAgICAgICAgICByZXR1cm4gYWxsb2NhdGlvbi5zZWxsaW5nX3BsYW5faWQgPT09IE51bWJlcihzZWxsaW5nUGxhblNlbGVjdC52YWx1ZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgX3RoaXM1LnVwZGF0ZVByb2R1Y3RQcmljZXMoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHVwZGF0ZUN1cnJlbnRTZWxsaW5nUGxhbiA9IGZ1bmN0aW9uIHVwZGF0ZUN1cnJlbnRTZWxsaW5nUGxhbigpIHtcbiAgICAgICAgICB2YXIgdmFyaWFudFNlbGxpbmdQbGFuR3JvdXBJZHMgPSBfdGhpczUuc2VsZWN0ZWRWYXJpYW50RGF0YS5zZWxsaW5nX3BsYW5fYWxsb2NhdGlvbnMubWFwKGZ1bmN0aW9uIChhbGxvY2F0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxsb2NhdGlvbi5zZWxsaW5nX3BsYW5fZ3JvdXBfaWQ7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjdXJyZW50U2VsbGluZ1BsYW5Hcm91cEVsID0gX3RvQ29uc3VtYWJsZUFycmF5KHNlbGxpbmdQbGFuc0dyb3VwRWxzKS5maW5kKGZ1bmN0aW9uIChncm91cEVsKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFyaWFudFNlbGxpbmdQbGFuR3JvdXBJZHMuaW5jbHVkZXMoZ3JvdXBFbC5kYXRhc2V0LmlkKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjdXJyZW50U2VsbGluZ1BsYW5TZWxlY3QgPSBjdXJyZW50U2VsbGluZ1BsYW5Hcm91cEVsLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXByb2R1Y3Qtc2VsbGluZy1wbGFucy1zZWxlY3RdJyk7XG4gICAgICAgICAgX3RoaXM1LnNlbGVjdGVkVmFyaWFudFNlbGxpbmdQbGFuID0gX3RoaXM1LnNlbGVjdGVkVmFyaWFudERhdGEuc2VsbGluZ19wbGFuX2FsbG9jYXRpb25zLmZpbmQoZnVuY3Rpb24gKGFsbG9jYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhbGxvY2F0aW9uLnNlbGxpbmdfcGxhbl9pZCA9PT0gTnVtYmVyKGN1cnJlbnRTZWxsaW5nUGxhblNlbGVjdC52YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc2VsbGluZ1BsYW5IaWRkZW5JbnB1dC52YWx1ZSA9IGN1cnJlbnRTZWxsaW5nUGxhblNlbGVjdC52YWx1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdXBkYXRlU2VsbGluZ1BsYW5Hcm91cHMgPSBmdW5jdGlvbiB1cGRhdGVTZWxsaW5nUGxhbkdyb3VwcygpIHtcbiAgICAgICAgICBzZWxsaW5nUGxhbnNHcm91cEVscy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cEVsKSB7XG4gICAgICAgICAgICByZXR1cm4gZ3JvdXBFbC5jbGFzc0xpc3QudG9nZ2xlKCdkLW5vbmUnLCBncm91cEVsLmRhdGFzZXQuaWQgIT09IF90aGlzNS5zZWxlY3RlZFZhcmlhbnRTZWxsaW5nUGxhbi5zZWxsaW5nX3BsYW5fZ3JvdXBfaWQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB1cGRhdGVTZWxsaW5nUGxhblByaWNlcyA9IGZ1bmN0aW9uIHVwZGF0ZVNlbGxpbmdQbGFuUHJpY2VzKCkge1xuICAgICAgICAgIGlmICghX3RoaXM1LnNlbGVjdGVkVmFyaWFudFNlbGxpbmdQbGFuKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgX3RoaXM1LnByb2R1Y3RTdWJzY3JpYmVDb21wYXJlUHJpY2VFbHMuZm9yRWFjaChmdW5jdGlvbiAocHJpY2VFbCkge1xuICAgICAgICAgICAgcHJpY2VFbC50ZXh0Q29udGVudCA9IFNob3BpZnkuZm9ybWF0TW9uZXkoX3RoaXM1LnNlbGVjdGVkVmFyaWFudERhdGEucHJpY2UpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgX3RoaXM1LnByb2R1Y3RTdWJzY3JpYmVQcmljZUVsLnRleHRDb250ZW50ID0gU2hvcGlmeS5mb3JtYXRNb25leShfdGhpczUuc2VsZWN0ZWRWYXJpYW50U2VsbGluZ1BsYW4ucHJpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHN1YnNjcmlwdGlvblRvZ2dsZVJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uICh0b2dnbGVSYWRpbykge1xuICAgICAgICAgIHRvZ2dsZVJhZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzNS5pc1NlbGxpbmdQbGFuU2VsZWN0ZWQgPSB0b2dnbGVSYWRpby52YWx1ZSA9PT0gJ3N1YnNjcmlwdGlvbic7XG4gICAgICAgICAgICBzZWxsaW5nUGxhbnNHcm91cFdyYXAuY2xhc3NMaXN0LnRvZ2dsZSgnZC1ub25lJywgIV90aGlzNS5pc1NlbGxpbmdQbGFuU2VsZWN0ZWQpO1xuICAgICAgICAgICAgdXBkYXRlQ3VycmVudFNlbGxpbmdQbGFuKCk7XG4gICAgICAgICAgICB1cGRhdGVTZWxsaW5nUGxhbkdyb3VwcygpO1xuXG4gICAgICAgICAgICBfdGhpczUudXBkYXRlUHJvZHVjdFByaWNlcygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcm9kdWN0U2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHVwZGF0ZUN1cnJlbnRTZWxsaW5nUGxhbigpO1xuICAgICAgICAgIHVwZGF0ZVNlbGxpbmdQbGFuR3JvdXBzKCk7XG4gICAgICAgICAgdXBkYXRlU2VsbGluZ1BsYW5QcmljZXMoKTtcblxuICAgICAgICAgIF90aGlzNS51cGRhdGVQcm9kdWN0UHJpY2VzKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIGtleTogXCJwcm9kdWN0R2FsbGVyaWVzSW5pdFwiLFxuICAgICAgdmFsdWU6IGZ1bmN0aW9uIHByb2R1Y3RHYWxsZXJpZXNJbml0KCkge1xuICAgICAgICB2YXIgX3RoaXM2ID0gdGhpcztcblxuICAgICAgICB2YXIgZ2FsbGVyeUNhcm91c2VscyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgncHJvZHVjdC1nYWxsZXJ5LWNhcm91c2VsJyk7XG4gICAgICAgIHZhciBncmlkR2FsbGVyeSA9IHRoaXMucXVlcnlTZWxlY3RvcigncHJvZHVjdC1nYWxsZXJ5LWdyaWQnKTtcbiAgICAgICAgdmFyIHNpbXBsZUdhbGxlcnkgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ3Byb2R1Y3QtZ2FsbGVyeS1zaW1wbGUnKTtcbiAgICAgICAgZ2FsbGVyeUNhcm91c2Vscy5mb3JFYWNoKGZ1bmN0aW9uIChjYXJvdXNlbCkge1xuICAgICAgICAgIGNhcm91c2VsLnNlbGVjdGVkVmFyaWFudCA9IF90aGlzNi5zZWxlY3RlZFZhcmlhbnREYXRhO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcm9kdWN0U2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBnYWxsZXJ5Q2Fyb3VzZWxzLmZvckVhY2goZnVuY3Rpb24gKGNhcm91c2VsKSB7XG4gICAgICAgICAgICBjYXJvdXNlbC5zZWxlY3RlZFZhcmlhbnQgPSBfdGhpczYuc2VsZWN0ZWRWYXJpYW50RGF0YTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChncmlkR2FsbGVyeSkge1xuICAgICAgICAgICAgZ3JpZEdhbGxlcnkuc2VsZWN0ZWRWYXJpYW50ID0gX3RoaXM2LnNlbGVjdGVkVmFyaWFudERhdGE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHNpbXBsZUdhbGxlcnkpIHtcbiAgICAgICAgICAgIHNpbXBsZUdhbGxlcnkuc2VsZWN0ZWRWYXJpYW50ID0gX3RoaXM2LnNlbGVjdGVkVmFyaWFudERhdGE7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XSk7XG5cbiAgICByZXR1cm4gUHJvZHVjdFdyYXA7XG4gIH0oIC8qI19fUFVSRV9fKi9fd3JhcE5hdGl2ZVN1cGVyKEhUTUxFbGVtZW50KSk7XG5cbiAgd2luZG93LmN1c3RvbUVsZW1lbnRzLmRlZmluZSgncHJvZHVjdC13cmFwJywgUHJvZHVjdFdyYXApO1xufSkoKTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/views/sections/product/product.js\n");

/***/ }),

/***/ "./src/views/sections/product/product.scss":
/*!*************************************************!*\
  !*** ./src/views/sections/product/product.scss ***!
  \*************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3Mvc2VjdGlvbnMvcHJvZHVjdC9wcm9kdWN0LnNjc3MuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvdmlld3Mvc2VjdGlvbnMvcHJvZHVjdC9wcm9kdWN0LnNjc3M/YTkxZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW5cbmV4cG9ydCB7fTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/views/sections/product/product.scss\n");

/***/ }),

/***/ "./src/views/snippets/back-in-stock-form/back-in-stock-form.js":
/*!*********************************************************************!*\
  !*** ./src/views/snippets/back-in-stock-form/back-in-stock-form.js ***!
  \*********************************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _scripts_core_custom_html_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @scripts/core/custom-html-element */ \"./src/scripts/core/custom-html-element.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\nObject(_scripts_core_custom_html_element__WEBPACK_IMPORTED_MODULE_0__[\"default\"])('bis-form', /*#__PURE__*/function (_HTMLElement) {\n  _inherits(_class, _HTMLElement);\n\n  var _super = _createSuper(_class);\n\n  function _class() {\n    var _this;\n\n    _classCallCheck(this, _class);\n\n    _this = _super.call(this);\n    _this.parentProductEl = _this.closest('product-wrap');\n\n    if (!_this.parentProductEl) {\n      return _possibleConstructorReturn(_this);\n    }\n\n    _this.bisForm = _this.querySelector('[data-bis-form]');\n    _this.bisVariantInput = _this.querySelector('[data-bis-variant]');\n    _this.bisEmailInput = _this.querySelector('[data-bis-email]');\n    _this.successEl = _this.querySelector('[data-bis-success-response]');\n    _this.errorEl = _this.querySelector('[data-bis-error-response]');\n    _this.app = _this.getAttribute('data-app');\n\n    if (_this.parentProductEl) {\n      _this.selectedVariantData = _this.parentProductEl.selectedVariantData;\n    }\n\n    _this.bisInit();\n\n    return _this;\n  }\n\n  _createClass(_class, [{\n    key: \"bisInit\",\n    value: function bisInit() {\n      var _this2 = this;\n\n      this.bisForm.addEventListener('submit', /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(event) {\n          var variantId;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  event.preventDefault();\n                  variantId = Number(_this2.bisVariantInput.value);\n                  _context.prev = 2;\n\n                  if (!(_this2.app === 'back_in_stock')) {\n                    _context.next = 8;\n                    break;\n                  }\n\n                  _context.next = 6;\n                  return _this2.handleBisAppSubmit(variantId);\n\n                case 6:\n                  _context.next = 14;\n                  break;\n\n                case 8:\n                  if (!(_this2.app === 'klaviyo')) {\n                    _context.next = 13;\n                    break;\n                  }\n\n                  _context.next = 11;\n                  return _this2.handleKlaviyoBisSubmit();\n\n                case 11:\n                  _context.next = 14;\n                  break;\n\n                case 13:\n                  throw new Error('app not defined');\n\n                case 14:\n                  _this2.bisForm.classList.add('d-none');\n\n                  _this2.successEl.classList.remove('d-none');\n\n                  _this2.errorEl.classList.add('d-none');\n\n                  _context.next = 25;\n                  break;\n\n                case 19:\n                  _context.prev = 19;\n                  _context.t0 = _context[\"catch\"](2);\n\n                  _this2.bisForm.classList.add('d-none');\n\n                  _this2.successEl.classList.add('d-none');\n\n                  _this2.errorEl.classList.remove('d-none');\n\n                  console.error(_context.t0);\n\n                case 25:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[2, 19]]);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"handleVariantUpdate\",\n    value: function handleVariantUpdate(variantData) {\n      if (variantData) {\n        this.selectedVariantData = variantData;\n        this.bisVariantInput.value = Number(variantData.id);\n      }\n\n      this.classList.toggle('d-none', !variantData || variantData.available);\n    }\n  }, {\n    key: \"handleBisAppSubmit\",\n    value: function () {\n      var _handleBisAppSubmit = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(variantId) {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  if (typeof window.BISPopover === 'undefined') {\n                    reject(Error('BISPopover not defined'));\n                  }\n\n                  BISPopover.create(bisEmailInput.value, variantId).then(function (data) {\n                    // eslint-disable-line\n                    if (data.status !== 'OK') {\n                      reject(Error(data.errors.base[0]));\n                    } else {\n                      resolve(data);\n                    }\n                  });\n                }));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function handleBisAppSubmit(_x2) {\n        return _handleBisAppSubmit.apply(this, arguments);\n      }\n\n      return handleBisAppSubmit;\n    }()\n  }, {\n    key: \"handleKlaviyoBisSubmit\",\n    value: function () {\n      var _handleKlaviyoBisSubmit = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var data;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                data = new window.FormData(this.bisForm);\n                _context3.prev = 1;\n                return _context3.abrupt(\"return\", fetch('https://a.klaviyo.com/onsite/components/back-in-stock/subscribe', {\n                  method: 'POST',\n                  body: data\n                }).then(function (response) {\n                  return response;\n                }));\n\n              case 5:\n                _context3.prev = 5;\n                _context3.t0 = _context3[\"catch\"](1);\n                return _context3.abrupt(\"return\", Promise.reject(_context3.t0));\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[1, 5]]);\n      }));\n\n      function handleKlaviyoBisSubmit() {\n        return _handleKlaviyoBisSubmit.apply(this, arguments);\n      }\n\n      return handleKlaviyoBisSubmit;\n    }()\n  }]);\n\n  return _class;\n}( /*#__PURE__*/_wrapNativeSuper(HTMLElement)));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3Mvc25pcHBldHMvYmFjay1pbi1zdG9jay1mb3JtL2JhY2staW4tc3RvY2stZm9ybS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9zbmlwcGV0cy9iYWNrLWluLXN0b2NrLWZvcm0vYmFjay1pbi1zdG9jay1mb3JtLmpzPzgwMjMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgXCJAYmFiZWwvaGVscGVycyAtIHR5cGVvZlwiOyByZXR1cm4gX3R5cGVvZiA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIFwic3ltYm9sXCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH0sIF90eXBlb2Yob2JqKTsgfVxuXG5mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9XG5cbmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwibmV4dFwiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwidGhyb3dcIiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfVxuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCBcInByb3RvdHlwZVwiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09IFwiZnVuY3Rpb25cIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvblwiKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgXCJwcm90b3R5cGVcIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9XG5cbmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikpIHsgcmV0dXJuIGNhbGw7IH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZFwiKTsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfVxuXG5mdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIHNlbGY7IH1cblxuZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykgeyB2YXIgX2NhY2hlID0gdHlwZW9mIE1hcCA9PT0gXCJmdW5jdGlvblwiID8gbmV3IE1hcCgpIDogdW5kZWZpbmVkOyBfd3JhcE5hdGl2ZVN1cGVyID0gZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykgeyBpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzOyBpZiAodHlwZW9mIENsYXNzICE9PSBcImZ1bmN0aW9uXCIpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uXCIpOyB9IGlmICh0eXBlb2YgX2NhY2hlICE9PSBcInVuZGVmaW5lZFwiKSB7IGlmIChfY2FjaGUuaGFzKENsYXNzKSkgcmV0dXJuIF9jYWNoZS5nZXQoQ2xhc3MpOyBfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTsgfSBmdW5jdGlvbiBXcmFwcGVyKCkgeyByZXR1cm4gX2NvbnN0cnVjdChDbGFzcywgYXJndW1lbnRzLCBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpOyB9IFdyYXBwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IFdyYXBwZXIsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IHJldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpOyB9OyByZXR1cm4gX3dyYXBOYXRpdmVTdXBlcihDbGFzcyk7IH1cblxuZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7IGlmIChfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkpIHsgX2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0OyB9IGVsc2UgeyBfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7IHZhciBhID0gW251bGxdOyBhLnB1c2guYXBwbHkoYSwgYXJncyk7IHZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTsgdmFyIGluc3RhbmNlID0gbmV3IENvbnN0cnVjdG9yKCk7IGlmIChDbGFzcykgX3NldFByb3RvdHlwZU9mKGluc3RhbmNlLCBDbGFzcy5wcm90b3R5cGUpOyByZXR1cm4gaW5zdGFuY2U7IH07IH0gcmV0dXJuIF9jb25zdHJ1Y3QuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsgfVxuXG5mdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwidW5kZWZpbmVkXCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIHRydWU7IHRyeSB7IEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTsgcmV0dXJuIHRydWU7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlOyB9IH1cblxuZnVuY3Rpb24gX2lzTmF0aXZlRnVuY3Rpb24oZm4pIHsgcmV0dXJuIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoZm4pLmluZGV4T2YoXCJbbmF0aXZlIGNvZGVdXCIpICE9PSAtMTsgfVxuXG5mdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfVxuXG5mdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9XG5cbmltcG9ydCBuZXdDdXN0b21FbGVtZW50IGZyb20gJ0BzY3JpcHRzL2NvcmUvY3VzdG9tLWh0bWwtZWxlbWVudCc7XG5uZXdDdXN0b21FbGVtZW50KCdiaXMtZm9ybScsIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0hUTUxFbGVtZW50KSB7XG4gIF9pbmhlcml0cyhfY2xhc3MsIF9IVE1MRWxlbWVudCk7XG5cbiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihfY2xhc3MpO1xuXG4gIGZ1bmN0aW9uIF9jbGFzcygpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgX2NsYXNzKTtcblxuICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcyk7XG4gICAgX3RoaXMucGFyZW50UHJvZHVjdEVsID0gX3RoaXMuY2xvc2VzdCgncHJvZHVjdC13cmFwJyk7XG5cbiAgICBpZiAoIV90aGlzLnBhcmVudFByb2R1Y3RFbCkge1xuICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKF90aGlzKTtcbiAgICB9XG5cbiAgICBfdGhpcy5iaXNGb3JtID0gX3RoaXMucXVlcnlTZWxlY3RvcignW2RhdGEtYmlzLWZvcm1dJyk7XG4gICAgX3RoaXMuYmlzVmFyaWFudElucHV0ID0gX3RoaXMucXVlcnlTZWxlY3RvcignW2RhdGEtYmlzLXZhcmlhbnRdJyk7XG4gICAgX3RoaXMuYmlzRW1haWxJbnB1dCA9IF90aGlzLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWJpcy1lbWFpbF0nKTtcbiAgICBfdGhpcy5zdWNjZXNzRWwgPSBfdGhpcy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1iaXMtc3VjY2Vzcy1yZXNwb25zZV0nKTtcbiAgICBfdGhpcy5lcnJvckVsID0gX3RoaXMucXVlcnlTZWxlY3RvcignW2RhdGEtYmlzLWVycm9yLXJlc3BvbnNlXScpO1xuICAgIF90aGlzLmFwcCA9IF90aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1hcHAnKTtcblxuICAgIGlmIChfdGhpcy5wYXJlbnRQcm9kdWN0RWwpIHtcbiAgICAgIF90aGlzLnNlbGVjdGVkVmFyaWFudERhdGEgPSBfdGhpcy5wYXJlbnRQcm9kdWN0RWwuc2VsZWN0ZWRWYXJpYW50RGF0YTtcbiAgICB9XG5cbiAgICBfdGhpcy5iaXNJbml0KCk7XG5cbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoX2NsYXNzLCBbe1xuICAgIGtleTogXCJiaXNJbml0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGJpc0luaXQoKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgdGhpcy5iaXNGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGV2ZW50KSB7XG4gICAgICAgICAgdmFyIHZhcmlhbnRJZDtcbiAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHtcbiAgICAgICAgICAgIHdoaWxlICgxKSB7XG4gICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgdmFyaWFudElkID0gTnVtYmVyKF90aGlzMi5iaXNWYXJpYW50SW5wdXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI7XG5cbiAgICAgICAgICAgICAgICAgIGlmICghKF90aGlzMi5hcHAgPT09ICdiYWNrX2luX3N0b2NrJykpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuaGFuZGxlQmlzQXBwU3VibWl0KHZhcmlhbnRJZCk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7XG4gICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgIGlmICghKF90aGlzMi5hcHAgPT09ICdrbGF2aXlvJykpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5oYW5kbGVLbGF2aXlvQmlzU3VibWl0KCk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDExOlxuICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0O1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDEzOlxuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdhcHAgbm90IGRlZmluZWQnKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICAgICAgICBfdGhpczIuYmlzRm9ybS5jbGFzc0xpc3QuYWRkKCdkLW5vbmUnKTtcblxuICAgICAgICAgICAgICAgICAgX3RoaXMyLnN1Y2Nlc3NFbC5jbGFzc0xpc3QucmVtb3ZlKCdkLW5vbmUnKTtcblxuICAgICAgICAgICAgICAgICAgX3RoaXMyLmVycm9yRWwuY2xhc3NMaXN0LmFkZCgnZC1ub25lJyk7XG5cbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAxOTpcbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxOTtcbiAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbXCJjYXRjaFwiXSgyKTtcblxuICAgICAgICAgICAgICAgICAgX3RoaXMyLmJpc0Zvcm0uY2xhc3NMaXN0LmFkZCgnZC1ub25lJyk7XG5cbiAgICAgICAgICAgICAgICAgIF90aGlzMi5zdWNjZXNzRWwuY2xhc3NMaXN0LmFkZCgnZC1ub25lJyk7XG5cbiAgICAgICAgICAgICAgICAgIF90aGlzMi5lcnJvckVsLmNsYXNzTGlzdC5yZW1vdmUoJ2Qtbm9uZScpO1xuXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKF9jb250ZXh0LnQwKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgMjU6XG4gICAgICAgICAgICAgICAgY2FzZSBcImVuZFwiOlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMiwgMTldXSk7XG4gICAgICAgIH0pKTtcblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7XG4gICAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfTtcbiAgICAgIH0oKSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImhhbmRsZVZhcmlhbnRVcGRhdGVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlVmFyaWFudFVwZGF0ZSh2YXJpYW50RGF0YSkge1xuICAgICAgaWYgKHZhcmlhbnREYXRhKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWYXJpYW50RGF0YSA9IHZhcmlhbnREYXRhO1xuICAgICAgICB0aGlzLmJpc1ZhcmlhbnRJbnB1dC52YWx1ZSA9IE51bWJlcih2YXJpYW50RGF0YS5pZCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgnZC1ub25lJywgIXZhcmlhbnREYXRhIHx8IHZhcmlhbnREYXRhLmF2YWlsYWJsZSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImhhbmRsZUJpc0FwcFN1Ym1pdFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2hhbmRsZUJpc0FwcFN1Ym1pdCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIodmFyaWFudElkKSB7XG4gICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7XG4gICAgICAgICAgd2hpbGUgKDEpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkge1xuICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoXCJyZXR1cm5cIiwgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuQklTUG9wb3ZlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KEVycm9yKCdCSVNQb3BvdmVyIG5vdCBkZWZpbmVkJykpO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBCSVNQb3BvdmVyLmNyZWF0ZShiaXNFbWFpbElucHV0LnZhbHVlLCB2YXJpYW50SWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgIT09ICdPSycpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZWplY3QoRXJyb3IoZGF0YS5lcnJvcnMuYmFzZVswXSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIGNhc2UgXCJlbmRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIF9jYWxsZWUyKTtcbiAgICAgIH0pKTtcblxuICAgICAgZnVuY3Rpb24gaGFuZGxlQmlzQXBwU3VibWl0KF94Mikge1xuICAgICAgICByZXR1cm4gX2hhbmRsZUJpc0FwcFN1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gaGFuZGxlQmlzQXBwU3VibWl0O1xuICAgIH0oKVxuICB9LCB7XG4gICAga2V5OiBcImhhbmRsZUtsYXZpeW9CaXNTdWJtaXRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF9oYW5kbGVLbGF2aXlvQmlzU3VibWl0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHtcbiAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7XG4gICAgICAgICAgd2hpbGUgKDEpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkge1xuICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgZGF0YSA9IG5ldyB3aW5kb3cuRm9ybURhdGEodGhpcy5iaXNGb3JtKTtcbiAgICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoXCJyZXR1cm5cIiwgZmV0Y2goJ2h0dHBzOi8vYS5rbGF2aXlvLmNvbS9vbnNpdGUvY29tcG9uZW50cy9iYWNrLWluLXN0b2NrL3N1YnNjcmliZScsIHtcbiAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgYm9keTogZGF0YVxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDU7XG4gICAgICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzW1wiY2F0Y2hcIl0oMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoXCJyZXR1cm5cIiwgUHJvbWlzZS5yZWplY3QoX2NvbnRleHQzLnQwKSk7XG5cbiAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICBjYXNlIFwiZW5kXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LCBfY2FsbGVlMywgdGhpcywgW1sxLCA1XV0pO1xuICAgICAgfSkpO1xuXG4gICAgICBmdW5jdGlvbiBoYW5kbGVLbGF2aXlvQmlzU3VibWl0KCkge1xuICAgICAgICByZXR1cm4gX2hhbmRsZUtsYXZpeW9CaXNTdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGhhbmRsZUtsYXZpeW9CaXNTdWJtaXQ7XG4gICAgfSgpXG4gIH1dKTtcblxuICByZXR1cm4gX2NsYXNzO1xufSggLyojX19QVVJFX18qL193cmFwTmF0aXZlU3VwZXIoSFRNTEVsZW1lbnQpKSk7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/views/snippets/back-in-stock-form/back-in-stock-form.js\n");

/***/ }),

/***/ "./src/views/snippets/product-gallery/product-gallery.js":
/*!***************************************************************!*\
  !*** ./src/views/snippets/product-gallery/product-gallery.js ***!
  \***************************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _scripts_core_custom_html_element__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @scripts/core/custom-html-element */ \"./src/scripts/core/custom-html-element.js\");\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n\nObject(_scripts_core_custom_html_element__WEBPACK_IMPORTED_MODULE_0__[\"default\"])('product-gallery-carousel', /*#__PURE__*/function (_HTMLElement) {\n  _inherits(_class, _HTMLElement);\n\n  var _super = _createSuper(_class);\n\n  function _class() {\n    var _this;\n\n    _classCallCheck(this, _class);\n\n    _this = _super.call(this);\n    _this.parentProductEl = _this.closest('product-wrap');\n    _this.slideEls = _this.querySelectorAll('[data-product-gallery-slide]');\n    _this.mediaEls = _this.querySelectorAll('[data-product-media-item]');\n    _this.paginationStyle = _this.getAttribute('data-pagination-style');\n    _this.isFilterItemsByColor = _this.getAttribute('data-filter-by-color');\n    _this.colorOptionIndex = _this.getAttribute('data-color-option-index');\n    _this.activeSlide = _toConsumableArray(_this.slideEls).find(function (slide) {\n      return slide.matches('[data-first-slide-index]');\n    });\n    _this.filteredSlides = _toConsumableArray(_this.slideEls);\n    _this.swiper = null;\n    _this.thumbSwiper = null;\n    _this.variantData = {};\n    return _this;\n  }\n\n  _createClass(_class, [{\n    key: \"initCarouselGallery\",\n    value: function initCarouselGallery() {\n      if (this.isFilterItemsByColor === 'true') {\n        this.filteredSlides = this.filterItemsByColor();\n\n        if (this.filteredSlides.length) {\n          var filteredItemIds = this.filteredSlides.map(function (slide) {\n            return slide.dataset.mediaId;\n          });\n          this.slideEls.forEach(function (slideEl) {\n            slideEl.classList.remove('hide');\n\n            if (!filteredItemIds.includes(slideEl.dataset.mediaId)) {\n              slideEl.remove();\n            }\n          });\n        }\n      } else {\n        this.slideEls.forEach(function (slideEl) {\n          slideEl.classList.remove('hide');\n        });\n      }\n\n      if (this.paginationStyle === 'thumbnail_carousel') {\n        this.thumbSwiper = this.initPaginationSwiper();\n      }\n\n      this.swiper = this.initSwiper();\n    }\n  }, {\n    key: \"buildPaginationSwiperSlides\",\n    value: function buildPaginationSwiperSlides() {\n      return this.filteredSlides.map(function (slide) {\n        return \"<div class=\\\"swiper-slide swiper-pagination-thumbnail swiper-pagination-thumbnail--slide\\\">\".concat(slide.dataset.thumbImage, \"</div>\");\n      });\n    }\n  }, {\n    key: \"filterItemsByColor\",\n    value: function filterItemsByColor() {\n      var variantColor = this.variantData[\"option\".concat(this.colorOptionIndex)];\n\n      if (!variantColor) {\n        return _toConsumableArray(this.slideEls);\n      }\n\n      return _toConsumableArray(this.slideEls).filter(function (slide) {\n        var slideAltSplit = slide.dataset.altText.split('|');\n        var slideColor = slideAltSplit.length > 1 ? slideAltSplit[1].trim() : false;\n        return !slideColor || slideColor === variantColor;\n      });\n    }\n  }, {\n    key: \"initSwiper\",\n    value: function initSwiper() {\n      var _this2 = this;\n\n      var paginationEl = this.querySelector('[data-product-gallery-pagination]');\n      var swiperOptions = {\n        loop: false,\n        slidesPerView: 1,\n        threshold: 5,\n        observer: true,\n        observeParents: true\n      };\n\n      if (this.activeSlide) {\n        swiperOptions.initialSlide = Number(this.activeSlide.getAttribute('data-first-slide-index'));\n      }\n\n      if (this.paginationStyle === 'dots') {\n        swiperOptions.pagination = {\n          el: paginationEl,\n          clickable: true,\n          type: 'bullets'\n        };\n      } else if (this.paginationStyle === 'thumbnail_carousel') {\n        swiperOptions.thumbs = {\n          swiper: this.thumbSwiper,\n          autoScrollOffset: 1\n        };\n      } else if (this.paginationStyle === 'thumbnails') {\n        swiperOptions.pagination = {\n          el: paginationEl,\n          clickable: true,\n          bulletClass: 'swiper-pagination-thumbnail',\n          renderBullet: function renderBullet(index, className) {\n            var matchingSlide = _this2.filteredSlides.find(function (slide, i) {\n              return i === index;\n            });\n\n            if (!matchingSlide) {\n              return '';\n            }\n\n            return \"<span class=\\\"\".concat(className, \"\\\">\").concat(matchingSlide.dataset.thumbImage, \"</span>\");\n          }\n        };\n      }\n\n      return new Swiper(this, swiperOptions);\n    }\n  }, {\n    key: \"initPaginationSwiper\",\n    value: function initPaginationSwiper() {\n      var thumbSliderEl = this.querySelector('[data-product-gallery-thumbs-slider]');\n      var swiperOptions = {\n        loop: false,\n        slidesPerView: 'auto',\n        observer: true,\n        observeParents: true\n      };\n\n      if (this.activeSlide) {\n        swiperOptions.initialSlide = Number(this.activeSlide.getAttribute('data-first-slide-index'));\n      }\n\n      var thumbSwiper = new Swiper(thumbSliderEl, swiperOptions);\n      var thumbSlides = this.buildPaginationSwiperSlides();\n      thumbSwiper.appendSlide(thumbSlides);\n      thumbSwiper.update();\n      return thumbSwiper;\n    }\n  }, {\n    key: \"selectedVariant\",\n    get: function get() {\n      return this.variantData;\n    },\n    set: function set(variantJson) {\n      this.variantData = variantJson;\n\n      if (!this.swiper) {\n        this.initCarouselGallery();\n        return;\n      }\n\n      if (this.isFilterItemsByColor === 'true') {\n        this.filteredSlides = this.filterItemsByColor(); // Update main slider\n\n        this.swiper.removeAllSlides();\n        this.swiper.appendSlide(this.filteredSlides);\n        this.swiper.update();\n        this.swiper.slideTo(0, false); // Update thumbnail carousel\n\n        if (this.thumbSwiper) {\n          var filteredThumbs = this.buildPaginationSwiperSlides();\n          this.thumbSwiper.removeAllSlides();\n          this.thumbSwiper.appendSlide(filteredThumbs);\n          this.thumbSwiper.update();\n          this.thumbSwiper.slideTo(0, false);\n        }\n      } else {\n        var matchingMediaItem = _toConsumableArray(this.mediaEls).find(function (mediaItem) {\n          var _mediaItem$dataset$va;\n\n          return (_mediaItem$dataset$va = mediaItem.dataset.variantIds) === null || _mediaItem$dataset$va === void 0 ? void 0 : _mediaItem$dataset$va.includes(variantJson.id);\n        });\n\n        if (!matchingMediaItem) {\n          return;\n        }\n\n        var slideIndex = Number(matchingMediaItem.dataset.itemIndex);\n        this.swiper.slideTo(slideIndex, false);\n\n        if (this.thumbSwiper) {\n          this.thumbSwiper.slideTo(slideIndex, false);\n        }\n      }\n    }\n  }]);\n\n  return _class;\n}( /*#__PURE__*/_wrapNativeSuper(HTMLElement)));\nObject(_scripts_core_custom_html_element__WEBPACK_IMPORTED_MODULE_0__[\"default\"])('product-gallery-simple', /*#__PURE__*/function (_HTMLElement2) {\n  _inherits(_class2, _HTMLElement2);\n\n  var _super2 = _createSuper(_class2);\n\n  function _class2() {\n    var _this3;\n\n    _classCallCheck(this, _class2);\n\n    _this3 = _super2.call(this);\n    _this3.productEl = _this3.closest('product-wrap');\n    _this3.thumbnails = _this3.productEl.querySelectorAll('[data-product-thumbnail]');\n    _this3.mediaItems = _this3.querySelectorAll('[data-product-media-item]');\n    _this3.isFilterItemsByColor = _this3.dataset.filterByColor === 'true';\n    _this3.colorOptionIndex = _this3.dataset.colorOptionIndex;\n    _this3.selectedVariant = null;\n\n    _this3.simpleGalleryInit();\n\n    return _this3;\n  }\n\n  _createClass(_class2, [{\n    key: \"simpleGalleryInit\",\n    value: function simpleGalleryInit() {\n      var _this4 = this;\n\n      this.thumbnails.forEach(function (thumbnail) {\n        thumbnail.addEventListener('click', function () {\n          _this4.mediaItems.forEach(function (mediaItem) {\n            var isClickedButton = mediaItem.dataset.mediaId === thumbnail.dataset.mediaId;\n            mediaItem.classList.toggle('hide', !isClickedButton);\n          });\n\n          _this4.thumbnails.forEach(function (btn) {\n            var isClickedButton = btn === thumbnail;\n            btn.classList.toggle('active', isClickedButton);\n            btn.setAttribute('aria-select', isClickedButton);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"selectedVariant\",\n    get: function get() {\n      return this.selectedVariant;\n    },\n    set: function set(variantJson) {\n      var variantColor = variantJson[\"option\".concat(this.colorOptionIndex)];\n\n      var activeMediaItem = _toConsumableArray(this.mediaItems).find(function (mediaItem) {\n        var _mediaItem$dataset$va2;\n\n        return (_mediaItem$dataset$va2 = mediaItem.dataset.variantIds) === null || _mediaItem$dataset$va2 === void 0 ? void 0 : _mediaItem$dataset$va2.includes(variantJson.id);\n      });\n\n      if (!variantColor || !activeMediaItem || this.isFilterItemsByColor === false) {\n        return;\n      }\n\n      this.mediaItems.forEach(function (mediaItem) {\n        mediaItem.classList.toggle('hide', mediaItem !== activeMediaItem);\n      });\n\n      var activeThumbnail = _toConsumableArray(this.thumbnails).find(function (thumbnail) {\n        return thumbnail.dataset.mediaId === activeMediaItem.dataset.mediaId;\n      });\n\n      this.thumbnails.forEach(function (thumb) {\n        var isActiveButton = thumb === activeThumbnail;\n        var itemAltSplit = thumb.dataset.altText.split('|');\n        var thumbColor = itemAltSplit.length > 1 ? itemAltSplit[1].trim() : false;\n        thumb.classList.toggle('active', isActiveButton);\n        thumb.setAttribute('aria-selected', isActiveButton);\n        thumb.classList.toggle('hide', thumbColor && thumbColor !== variantColor);\n      });\n    }\n  }]);\n\n  return _class2;\n}( /*#__PURE__*/_wrapNativeSuper(HTMLElement)));\nObject(_scripts_core_custom_html_element__WEBPACK_IMPORTED_MODULE_0__[\"default\"])('product-gallery-grid', /*#__PURE__*/function (_HTMLElement3) {\n  _inherits(_class3, _HTMLElement3);\n\n  var _super3 = _createSuper(_class3);\n\n  function _class3() {\n    var _this5;\n\n    _classCallCheck(this, _class3);\n\n    _this5 = _super3.call(this);\n    _this5.gridItems = _this5.querySelectorAll('[data-grid-gallery-item]');\n    _this5.colorOptionIndex = _this5.dataset.colorOptionIndex;\n    _this5.isFilterItemsByColor = _this5.dataset.filterByColor === 'true';\n    _this5.selectedVariant = null;\n    return _this5;\n  }\n\n  _createClass(_class3, [{\n    key: \"selectedVariant\",\n    get: function get() {\n      return this.selectedVariant;\n    },\n    set: function set(variantJson) {\n      var variantColor = variantJson[\"option\".concat(this.colorOptionIndex)];\n\n      if (!variantColor || this.isFilterItemsByColor === false) {\n        return;\n      }\n\n      this.gridItems.forEach(function (gridItem) {\n        var itemAltSplit = gridItem.dataset.altText.split('|');\n        var itemColor = itemAltSplit.length > 1 ? itemAltSplit[1].trim() : false;\n        gridItem.classList.toggle('hide', itemColor && itemColor !== variantColor);\n      });\n    }\n  }]);\n\n  return _class3;\n}( /*#__PURE__*/_wrapNativeSuper(HTMLElement)));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdmlld3Mvc25pcHBldHMvcHJvZHVjdC1nYWxsZXJ5L3Byb2R1Y3QtZ2FsbGVyeS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy92aWV3cy9zbmlwcGV0cy9wcm9kdWN0LWdhbGxlcnkvcHJvZHVjdC1nYWxsZXJ5LmpzPzFkYmMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgXCJAYmFiZWwvaGVscGVycyAtIHR5cGVvZlwiOyByZXR1cm4gX3R5cGVvZiA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIFwic3ltYm9sXCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH0sIF90eXBlb2Yob2JqKTsgfVxuXG5mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH1cblxuZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLlwiKTsgfVxuXG5mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09IFwic3RyaW5nXCIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSBcIk9iamVjdFwiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSBcIk1hcFwiIHx8IG4gPT09IFwiU2V0XCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gXCJBcmd1bWVudHNcIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH1cblxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmICh0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbXCJAQGl0ZXJhdG9yXCJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9XG5cbmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KGFycik7IH1cblxuZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsIFwicHJvdG90eXBlXCIsIHsgd3JpdGFibGU6IGZhbHNlIH0pOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uXCIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCBcInByb3RvdHlwZVwiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH1cblxuZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH1cblxuZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgY2FsbCA9PT0gXCJmdW5jdGlvblwiKSkgeyByZXR1cm4gY2FsbDsgfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkRlcml2ZWQgY29uc3RydWN0b3JzIG1heSBvbmx5IHJldHVybiBvYmplY3Qgb3IgdW5kZWZpbmVkXCIpOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9XG5cbmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gc2VsZjsgfVxuXG5mdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7IHZhciBfY2FjaGUgPSB0eXBlb2YgTWFwID09PSBcImZ1bmN0aW9uXCIgPyBuZXcgTWFwKCkgOiB1bmRlZmluZWQ7IF93cmFwTmF0aXZlU3VwZXIgPSBmdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7IGlmIChDbGFzcyA9PT0gbnVsbCB8fCAhX2lzTmF0aXZlRnVuY3Rpb24oQ2xhc3MpKSByZXR1cm4gQ2xhc3M7IGlmICh0eXBlb2YgQ2xhc3MgIT09IFwiZnVuY3Rpb25cIikgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb25cIik7IH0gaWYgKHR5cGVvZiBfY2FjaGUgIT09IFwidW5kZWZpbmVkXCIpIHsgaWYgKF9jYWNoZS5oYXMoQ2xhc3MpKSByZXR1cm4gX2NhY2hlLmdldChDbGFzcyk7IF9jYWNoZS5zZXQoQ2xhc3MsIFdyYXBwZXIpOyB9IGZ1bmN0aW9uIFdyYXBwZXIoKSB7IHJldHVybiBfY29uc3RydWN0KENsYXNzLCBhcmd1bWVudHMsIF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3Rvcik7IH0gV3JhcHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogV3JhcHBlciwgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihXcmFwcGVyLCBDbGFzcyk7IH07IHJldHVybiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKTsgfVxuXG5mdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHsgaWYgKF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSkgeyBfY29uc3RydWN0ID0gUmVmbGVjdC5jb25zdHJ1Y3Q7IH0gZWxzZSB7IF9jb25zdHJ1Y3QgPSBmdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHsgdmFyIGEgPSBbbnVsbF07IGEucHVzaC5hcHBseShhLCBhcmdzKTsgdmFyIENvbnN0cnVjdG9yID0gRnVuY3Rpb24uYmluZC5hcHBseShQYXJlbnQsIGEpOyB2YXIgaW5zdGFuY2UgPSBuZXcgQ29uc3RydWN0b3IoKTsgaWYgKENsYXNzKSBfc2V0UHJvdG90eXBlT2YoaW5zdGFuY2UsIENsYXNzLnByb3RvdHlwZSk7IHJldHVybiBpbnN0YW5jZTsgfTsgfSByZXR1cm4gX2NvbnN0cnVjdC5hcHBseShudWxsLCBhcmd1bWVudHMpOyB9XG5cbmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhUmVmbGVjdC5jb25zdHJ1Y3QpIHJldHVybiBmYWxzZTsgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTsgaWYgKHR5cGVvZiBQcm94eSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfVxuXG5mdW5jdGlvbiBfaXNOYXRpdmVGdW5jdGlvbihmbikgeyByZXR1cm4gRnVuY3Rpb24udG9TdHJpbmcuY2FsbChmbikuaW5kZXhPZihcIltuYXRpdmUgY29kZV1cIikgIT09IC0xOyB9XG5cbmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9XG5cbmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH1cblxuaW1wb3J0IG5ld0N1c3RvbUVsZW1lbnQgZnJvbSAnQHNjcmlwdHMvY29yZS9jdXN0b20taHRtbC1lbGVtZW50Jztcbm5ld0N1c3RvbUVsZW1lbnQoJ3Byb2R1Y3QtZ2FsbGVyeS1jYXJvdXNlbCcsIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0hUTUxFbGVtZW50KSB7XG4gIF9pbmhlcml0cyhfY2xhc3MsIF9IVE1MRWxlbWVudCk7XG5cbiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihfY2xhc3MpO1xuXG4gIGZ1bmN0aW9uIF9jbGFzcygpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgX2NsYXNzKTtcblxuICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcyk7XG4gICAgX3RoaXMucGFyZW50UHJvZHVjdEVsID0gX3RoaXMuY2xvc2VzdCgncHJvZHVjdC13cmFwJyk7XG4gICAgX3RoaXMuc2xpZGVFbHMgPSBfdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1wcm9kdWN0LWdhbGxlcnktc2xpZGVdJyk7XG4gICAgX3RoaXMubWVkaWFFbHMgPSBfdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1wcm9kdWN0LW1lZGlhLWl0ZW1dJyk7XG4gICAgX3RoaXMucGFnaW5hdGlvblN0eWxlID0gX3RoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXBhZ2luYXRpb24tc3R5bGUnKTtcbiAgICBfdGhpcy5pc0ZpbHRlckl0ZW1zQnlDb2xvciA9IF90aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1maWx0ZXItYnktY29sb3InKTtcbiAgICBfdGhpcy5jb2xvck9wdGlvbkluZGV4ID0gX3RoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbG9yLW9wdGlvbi1pbmRleCcpO1xuICAgIF90aGlzLmFjdGl2ZVNsaWRlID0gX3RvQ29uc3VtYWJsZUFycmF5KF90aGlzLnNsaWRlRWxzKS5maW5kKGZ1bmN0aW9uIChzbGlkZSkge1xuICAgICAgcmV0dXJuIHNsaWRlLm1hdGNoZXMoJ1tkYXRhLWZpcnN0LXNsaWRlLWluZGV4XScpO1xuICAgIH0pO1xuICAgIF90aGlzLmZpbHRlcmVkU2xpZGVzID0gX3RvQ29uc3VtYWJsZUFycmF5KF90aGlzLnNsaWRlRWxzKTtcbiAgICBfdGhpcy5zd2lwZXIgPSBudWxsO1xuICAgIF90aGlzLnRodW1iU3dpcGVyID0gbnVsbDtcbiAgICBfdGhpcy52YXJpYW50RGF0YSA9IHt9O1xuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhfY2xhc3MsIFt7XG4gICAga2V5OiBcImluaXRDYXJvdXNlbEdhbGxlcnlcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdENhcm91c2VsR2FsbGVyeSgpIHtcbiAgICAgIGlmICh0aGlzLmlzRmlsdGVySXRlbXNCeUNvbG9yID09PSAndHJ1ZScpIHtcbiAgICAgICAgdGhpcy5maWx0ZXJlZFNsaWRlcyA9IHRoaXMuZmlsdGVySXRlbXNCeUNvbG9yKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyZWRTbGlkZXMubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIGZpbHRlcmVkSXRlbUlkcyA9IHRoaXMuZmlsdGVyZWRTbGlkZXMubWFwKGZ1bmN0aW9uIChzbGlkZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNsaWRlLmRhdGFzZXQubWVkaWFJZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLnNsaWRlRWxzLmZvckVhY2goZnVuY3Rpb24gKHNsaWRlRWwpIHtcbiAgICAgICAgICAgIHNsaWRlRWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuXG4gICAgICAgICAgICBpZiAoIWZpbHRlcmVkSXRlbUlkcy5pbmNsdWRlcyhzbGlkZUVsLmRhdGFzZXQubWVkaWFJZCkpIHtcbiAgICAgICAgICAgICAgc2xpZGVFbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zbGlkZUVscy5mb3JFYWNoKGZ1bmN0aW9uIChzbGlkZUVsKSB7XG4gICAgICAgICAgc2xpZGVFbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5wYWdpbmF0aW9uU3R5bGUgPT09ICd0aHVtYm5haWxfY2Fyb3VzZWwnKSB7XG4gICAgICAgIHRoaXMudGh1bWJTd2lwZXIgPSB0aGlzLmluaXRQYWdpbmF0aW9uU3dpcGVyKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc3dpcGVyID0gdGhpcy5pbml0U3dpcGVyKCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImJ1aWxkUGFnaW5hdGlvblN3aXBlclNsaWRlc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBidWlsZFBhZ2luYXRpb25Td2lwZXJTbGlkZXMoKSB7XG4gICAgICByZXR1cm4gdGhpcy5maWx0ZXJlZFNsaWRlcy5tYXAoZnVuY3Rpb24gKHNsaWRlKSB7XG4gICAgICAgIHJldHVybiBcIjxkaXYgY2xhc3M9XFxcInN3aXBlci1zbGlkZSBzd2lwZXItcGFnaW5hdGlvbi10aHVtYm5haWwgc3dpcGVyLXBhZ2luYXRpb24tdGh1bWJuYWlsLS1zbGlkZVxcXCI+XCIuY29uY2F0KHNsaWRlLmRhdGFzZXQudGh1bWJJbWFnZSwgXCI8L2Rpdj5cIik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZmlsdGVySXRlbXNCeUNvbG9yXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZpbHRlckl0ZW1zQnlDb2xvcigpIHtcbiAgICAgIHZhciB2YXJpYW50Q29sb3IgPSB0aGlzLnZhcmlhbnREYXRhW1wib3B0aW9uXCIuY29uY2F0KHRoaXMuY29sb3JPcHRpb25JbmRleCldO1xuXG4gICAgICBpZiAoIXZhcmlhbnRDb2xvcikge1xuICAgICAgICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuc2xpZGVFbHMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuc2xpZGVFbHMpLmZpbHRlcihmdW5jdGlvbiAoc2xpZGUpIHtcbiAgICAgICAgdmFyIHNsaWRlQWx0U3BsaXQgPSBzbGlkZS5kYXRhc2V0LmFsdFRleHQuc3BsaXQoJ3wnKTtcbiAgICAgICAgdmFyIHNsaWRlQ29sb3IgPSBzbGlkZUFsdFNwbGl0Lmxlbmd0aCA+IDEgPyBzbGlkZUFsdFNwbGl0WzFdLnRyaW0oKSA6IGZhbHNlO1xuICAgICAgICByZXR1cm4gIXNsaWRlQ29sb3IgfHwgc2xpZGVDb2xvciA9PT0gdmFyaWFudENvbG9yO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImluaXRTd2lwZXJcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdFN3aXBlcigpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB2YXIgcGFnaW5hdGlvbkVsID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wcm9kdWN0LWdhbGxlcnktcGFnaW5hdGlvbl0nKTtcbiAgICAgIHZhciBzd2lwZXJPcHRpb25zID0ge1xuICAgICAgICBsb29wOiBmYWxzZSxcbiAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgdGhyZXNob2xkOiA1LFxuICAgICAgICBvYnNlcnZlcjogdHJ1ZSxcbiAgICAgICAgb2JzZXJ2ZVBhcmVudHM6IHRydWVcbiAgICAgIH07XG5cbiAgICAgIGlmICh0aGlzLmFjdGl2ZVNsaWRlKSB7XG4gICAgICAgIHN3aXBlck9wdGlvbnMuaW5pdGlhbFNsaWRlID0gTnVtYmVyKHRoaXMuYWN0aXZlU2xpZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWZpcnN0LXNsaWRlLWluZGV4JykpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5wYWdpbmF0aW9uU3R5bGUgPT09ICdkb3RzJykge1xuICAgICAgICBzd2lwZXJPcHRpb25zLnBhZ2luYXRpb24gPSB7XG4gICAgICAgICAgZWw6IHBhZ2luYXRpb25FbCxcbiAgICAgICAgICBjbGlja2FibGU6IHRydWUsXG4gICAgICAgICAgdHlwZTogJ2J1bGxldHMnXG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucGFnaW5hdGlvblN0eWxlID09PSAndGh1bWJuYWlsX2Nhcm91c2VsJykge1xuICAgICAgICBzd2lwZXJPcHRpb25zLnRodW1icyA9IHtcbiAgICAgICAgICBzd2lwZXI6IHRoaXMudGh1bWJTd2lwZXIsXG4gICAgICAgICAgYXV0b1Njcm9sbE9mZnNldDogMVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnBhZ2luYXRpb25TdHlsZSA9PT0gJ3RodW1ibmFpbHMnKSB7XG4gICAgICAgIHN3aXBlck9wdGlvbnMucGFnaW5hdGlvbiA9IHtcbiAgICAgICAgICBlbDogcGFnaW5hdGlvbkVsLFxuICAgICAgICAgIGNsaWNrYWJsZTogdHJ1ZSxcbiAgICAgICAgICBidWxsZXRDbGFzczogJ3N3aXBlci1wYWdpbmF0aW9uLXRodW1ibmFpbCcsXG4gICAgICAgICAgcmVuZGVyQnVsbGV0OiBmdW5jdGlvbiByZW5kZXJCdWxsZXQoaW5kZXgsIGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgdmFyIG1hdGNoaW5nU2xpZGUgPSBfdGhpczIuZmlsdGVyZWRTbGlkZXMuZmluZChmdW5jdGlvbiAoc2xpZGUsIGkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGkgPT09IGluZGV4O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghbWF0Y2hpbmdTbGlkZSkge1xuICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBcIjxzcGFuIGNsYXNzPVxcXCJcIi5jb25jYXQoY2xhc3NOYW1lLCBcIlxcXCI+XCIpLmNvbmNhdChtYXRjaGluZ1NsaWRlLmRhdGFzZXQudGh1bWJJbWFnZSwgXCI8L3NwYW4+XCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBTd2lwZXIodGhpcywgc3dpcGVyT3B0aW9ucyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImluaXRQYWdpbmF0aW9uU3dpcGVyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRQYWdpbmF0aW9uU3dpcGVyKCkge1xuICAgICAgdmFyIHRodW1iU2xpZGVyRWwgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLXByb2R1Y3QtZ2FsbGVyeS10aHVtYnMtc2xpZGVyXScpO1xuICAgICAgdmFyIHN3aXBlck9wdGlvbnMgPSB7XG4gICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICAgIG9ic2VydmVyOiB0cnVlLFxuICAgICAgICBvYnNlcnZlUGFyZW50czogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgaWYgKHRoaXMuYWN0aXZlU2xpZGUpIHtcbiAgICAgICAgc3dpcGVyT3B0aW9ucy5pbml0aWFsU2xpZGUgPSBOdW1iZXIodGhpcy5hY3RpdmVTbGlkZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZmlyc3Qtc2xpZGUtaW5kZXgnKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciB0aHVtYlN3aXBlciA9IG5ldyBTd2lwZXIodGh1bWJTbGlkZXJFbCwgc3dpcGVyT3B0aW9ucyk7XG4gICAgICB2YXIgdGh1bWJTbGlkZXMgPSB0aGlzLmJ1aWxkUGFnaW5hdGlvblN3aXBlclNsaWRlcygpO1xuICAgICAgdGh1bWJTd2lwZXIuYXBwZW5kU2xpZGUodGh1bWJTbGlkZXMpO1xuICAgICAgdGh1bWJTd2lwZXIudXBkYXRlKCk7XG4gICAgICByZXR1cm4gdGh1bWJTd2lwZXI7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcInNlbGVjdGVkVmFyaWFudFwiLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMudmFyaWFudERhdGE7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YXJpYW50SnNvbikge1xuICAgICAgdGhpcy52YXJpYW50RGF0YSA9IHZhcmlhbnRKc29uO1xuXG4gICAgICBpZiAoIXRoaXMuc3dpcGVyKSB7XG4gICAgICAgIHRoaXMuaW5pdENhcm91c2VsR2FsbGVyeSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmlzRmlsdGVySXRlbXNCeUNvbG9yID09PSAndHJ1ZScpIHtcbiAgICAgICAgdGhpcy5maWx0ZXJlZFNsaWRlcyA9IHRoaXMuZmlsdGVySXRlbXNCeUNvbG9yKCk7IC8vIFVwZGF0ZSBtYWluIHNsaWRlclxuXG4gICAgICAgIHRoaXMuc3dpcGVyLnJlbW92ZUFsbFNsaWRlcygpO1xuICAgICAgICB0aGlzLnN3aXBlci5hcHBlbmRTbGlkZSh0aGlzLmZpbHRlcmVkU2xpZGVzKTtcbiAgICAgICAgdGhpcy5zd2lwZXIudXBkYXRlKCk7XG4gICAgICAgIHRoaXMuc3dpcGVyLnNsaWRlVG8oMCwgZmFsc2UpOyAvLyBVcGRhdGUgdGh1bWJuYWlsIGNhcm91c2VsXG5cbiAgICAgICAgaWYgKHRoaXMudGh1bWJTd2lwZXIpIHtcbiAgICAgICAgICB2YXIgZmlsdGVyZWRUaHVtYnMgPSB0aGlzLmJ1aWxkUGFnaW5hdGlvblN3aXBlclNsaWRlcygpO1xuICAgICAgICAgIHRoaXMudGh1bWJTd2lwZXIucmVtb3ZlQWxsU2xpZGVzKCk7XG4gICAgICAgICAgdGhpcy50aHVtYlN3aXBlci5hcHBlbmRTbGlkZShmaWx0ZXJlZFRodW1icyk7XG4gICAgICAgICAgdGhpcy50aHVtYlN3aXBlci51cGRhdGUoKTtcbiAgICAgICAgICB0aGlzLnRodW1iU3dpcGVyLnNsaWRlVG8oMCwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbWF0Y2hpbmdNZWRpYUl0ZW0gPSBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5tZWRpYUVscykuZmluZChmdW5jdGlvbiAobWVkaWFJdGVtKSB7XG4gICAgICAgICAgdmFyIF9tZWRpYUl0ZW0kZGF0YXNldCR2YTtcblxuICAgICAgICAgIHJldHVybiAoX21lZGlhSXRlbSRkYXRhc2V0JHZhID0gbWVkaWFJdGVtLmRhdGFzZXQudmFyaWFudElkcykgPT09IG51bGwgfHwgX21lZGlhSXRlbSRkYXRhc2V0JHZhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbWVkaWFJdGVtJGRhdGFzZXQkdmEuaW5jbHVkZXModmFyaWFudEpzb24uaWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIW1hdGNoaW5nTWVkaWFJdGVtKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNsaWRlSW5kZXggPSBOdW1iZXIobWF0Y2hpbmdNZWRpYUl0ZW0uZGF0YXNldC5pdGVtSW5kZXgpO1xuICAgICAgICB0aGlzLnN3aXBlci5zbGlkZVRvKHNsaWRlSW5kZXgsIGZhbHNlKTtcblxuICAgICAgICBpZiAodGhpcy50aHVtYlN3aXBlcikge1xuICAgICAgICAgIHRoaXMudGh1bWJTd2lwZXIuc2xpZGVUbyhzbGlkZUluZGV4LCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gX2NsYXNzO1xufSggLyojX19QVVJFX18qL193cmFwTmF0aXZlU3VwZXIoSFRNTEVsZW1lbnQpKSk7XG5uZXdDdXN0b21FbGVtZW50KCdwcm9kdWN0LWdhbGxlcnktc2ltcGxlJywgLyojX19QVVJFX18qL2Z1bmN0aW9uIChfSFRNTEVsZW1lbnQyKSB7XG4gIF9pbmhlcml0cyhfY2xhc3MyLCBfSFRNTEVsZW1lbnQyKTtcblxuICB2YXIgX3N1cGVyMiA9IF9jcmVhdGVTdXBlcihfY2xhc3MyKTtcblxuICBmdW5jdGlvbiBfY2xhc3MyKCkge1xuICAgIHZhciBfdGhpczM7XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgX2NsYXNzMik7XG5cbiAgICBfdGhpczMgPSBfc3VwZXIyLmNhbGwodGhpcyk7XG4gICAgX3RoaXMzLnByb2R1Y3RFbCA9IF90aGlzMy5jbG9zZXN0KCdwcm9kdWN0LXdyYXAnKTtcbiAgICBfdGhpczMudGh1bWJuYWlscyA9IF90aGlzMy5wcm9kdWN0RWwucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtcHJvZHVjdC10aHVtYm5haWxdJyk7XG4gICAgX3RoaXMzLm1lZGlhSXRlbXMgPSBfdGhpczMucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtcHJvZHVjdC1tZWRpYS1pdGVtXScpO1xuICAgIF90aGlzMy5pc0ZpbHRlckl0ZW1zQnlDb2xvciA9IF90aGlzMy5kYXRhc2V0LmZpbHRlckJ5Q29sb3IgPT09ICd0cnVlJztcbiAgICBfdGhpczMuY29sb3JPcHRpb25JbmRleCA9IF90aGlzMy5kYXRhc2V0LmNvbG9yT3B0aW9uSW5kZXg7XG4gICAgX3RoaXMzLnNlbGVjdGVkVmFyaWFudCA9IG51bGw7XG5cbiAgICBfdGhpczMuc2ltcGxlR2FsbGVyeUluaXQoKTtcblxuICAgIHJldHVybiBfdGhpczM7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoX2NsYXNzMiwgW3tcbiAgICBrZXk6IFwic2ltcGxlR2FsbGVyeUluaXRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gc2ltcGxlR2FsbGVyeUluaXQoKSB7XG4gICAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgICAgdGhpcy50aHVtYm5haWxzLmZvckVhY2goZnVuY3Rpb24gKHRodW1ibmFpbCkge1xuICAgICAgICB0aHVtYm5haWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXM0Lm1lZGlhSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAobWVkaWFJdGVtKSB7XG4gICAgICAgICAgICB2YXIgaXNDbGlja2VkQnV0dG9uID0gbWVkaWFJdGVtLmRhdGFzZXQubWVkaWFJZCA9PT0gdGh1bWJuYWlsLmRhdGFzZXQubWVkaWFJZDtcbiAgICAgICAgICAgIG1lZGlhSXRlbS5jbGFzc0xpc3QudG9nZ2xlKCdoaWRlJywgIWlzQ2xpY2tlZEJ1dHRvbik7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBfdGhpczQudGh1bWJuYWlscy5mb3JFYWNoKGZ1bmN0aW9uIChidG4pIHtcbiAgICAgICAgICAgIHZhciBpc0NsaWNrZWRCdXR0b24gPSBidG4gPT09IHRodW1ibmFpbDtcbiAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpc0NsaWNrZWRCdXR0b24pO1xuICAgICAgICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3QnLCBpc0NsaWNrZWRCdXR0b24pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJzZWxlY3RlZFZhcmlhbnRcIixcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkVmFyaWFudDtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gc2V0KHZhcmlhbnRKc29uKSB7XG4gICAgICB2YXIgdmFyaWFudENvbG9yID0gdmFyaWFudEpzb25bXCJvcHRpb25cIi5jb25jYXQodGhpcy5jb2xvck9wdGlvbkluZGV4KV07XG5cbiAgICAgIHZhciBhY3RpdmVNZWRpYUl0ZW0gPSBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5tZWRpYUl0ZW1zKS5maW5kKGZ1bmN0aW9uIChtZWRpYUl0ZW0pIHtcbiAgICAgICAgdmFyIF9tZWRpYUl0ZW0kZGF0YXNldCR2YTI7XG5cbiAgICAgICAgcmV0dXJuIChfbWVkaWFJdGVtJGRhdGFzZXQkdmEyID0gbWVkaWFJdGVtLmRhdGFzZXQudmFyaWFudElkcykgPT09IG51bGwgfHwgX21lZGlhSXRlbSRkYXRhc2V0JHZhMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21lZGlhSXRlbSRkYXRhc2V0JHZhMi5pbmNsdWRlcyh2YXJpYW50SnNvbi5pZCk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKCF2YXJpYW50Q29sb3IgfHwgIWFjdGl2ZU1lZGlhSXRlbSB8fCB0aGlzLmlzRmlsdGVySXRlbXNCeUNvbG9yID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMubWVkaWFJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChtZWRpYUl0ZW0pIHtcbiAgICAgICAgbWVkaWFJdGVtLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGUnLCBtZWRpYUl0ZW0gIT09IGFjdGl2ZU1lZGlhSXRlbSk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGFjdGl2ZVRodW1ibmFpbCA9IF90b0NvbnN1bWFibGVBcnJheSh0aGlzLnRodW1ibmFpbHMpLmZpbmQoZnVuY3Rpb24gKHRodW1ibmFpbCkge1xuICAgICAgICByZXR1cm4gdGh1bWJuYWlsLmRhdGFzZXQubWVkaWFJZCA9PT0gYWN0aXZlTWVkaWFJdGVtLmRhdGFzZXQubWVkaWFJZDtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRodW1ibmFpbHMuZm9yRWFjaChmdW5jdGlvbiAodGh1bWIpIHtcbiAgICAgICAgdmFyIGlzQWN0aXZlQnV0dG9uID0gdGh1bWIgPT09IGFjdGl2ZVRodW1ibmFpbDtcbiAgICAgICAgdmFyIGl0ZW1BbHRTcGxpdCA9IHRodW1iLmRhdGFzZXQuYWx0VGV4dC5zcGxpdCgnfCcpO1xuICAgICAgICB2YXIgdGh1bWJDb2xvciA9IGl0ZW1BbHRTcGxpdC5sZW5ndGggPiAxID8gaXRlbUFsdFNwbGl0WzFdLnRyaW0oKSA6IGZhbHNlO1xuICAgICAgICB0aHVtYi5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpc0FjdGl2ZUJ1dHRvbik7XG4gICAgICAgIHRodW1iLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsIGlzQWN0aXZlQnV0dG9uKTtcbiAgICAgICAgdGh1bWIuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZScsIHRodW1iQ29sb3IgJiYgdGh1bWJDb2xvciAhPT0gdmFyaWFudENvbG9yKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBfY2xhc3MyO1xufSggLyojX19QVVJFX18qL193cmFwTmF0aXZlU3VwZXIoSFRNTEVsZW1lbnQpKSk7XG5uZXdDdXN0b21FbGVtZW50KCdwcm9kdWN0LWdhbGxlcnktZ3JpZCcsIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0hUTUxFbGVtZW50Mykge1xuICBfaW5oZXJpdHMoX2NsYXNzMywgX0hUTUxFbGVtZW50Myk7XG5cbiAgdmFyIF9zdXBlcjMgPSBfY3JlYXRlU3VwZXIoX2NsYXNzMyk7XG5cbiAgZnVuY3Rpb24gX2NsYXNzMygpIHtcbiAgICB2YXIgX3RoaXM1O1xuXG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIF9jbGFzczMpO1xuXG4gICAgX3RoaXM1ID0gX3N1cGVyMy5jYWxsKHRoaXMpO1xuICAgIF90aGlzNS5ncmlkSXRlbXMgPSBfdGhpczUucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZ3JpZC1nYWxsZXJ5LWl0ZW1dJyk7XG4gICAgX3RoaXM1LmNvbG9yT3B0aW9uSW5kZXggPSBfdGhpczUuZGF0YXNldC5jb2xvck9wdGlvbkluZGV4O1xuICAgIF90aGlzNS5pc0ZpbHRlckl0ZW1zQnlDb2xvciA9IF90aGlzNS5kYXRhc2V0LmZpbHRlckJ5Q29sb3IgPT09ICd0cnVlJztcbiAgICBfdGhpczUuc2VsZWN0ZWRWYXJpYW50ID0gbnVsbDtcbiAgICByZXR1cm4gX3RoaXM1O1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKF9jbGFzczMsIFt7XG4gICAga2V5OiBcInNlbGVjdGVkVmFyaWFudFwiLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRWYXJpYW50O1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiBzZXQodmFyaWFudEpzb24pIHtcbiAgICAgIHZhciB2YXJpYW50Q29sb3IgPSB2YXJpYW50SnNvbltcIm9wdGlvblwiLmNvbmNhdCh0aGlzLmNvbG9yT3B0aW9uSW5kZXgpXTtcblxuICAgICAgaWYgKCF2YXJpYW50Q29sb3IgfHwgdGhpcy5pc0ZpbHRlckl0ZW1zQnlDb2xvciA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmdyaWRJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChncmlkSXRlbSkge1xuICAgICAgICB2YXIgaXRlbUFsdFNwbGl0ID0gZ3JpZEl0ZW0uZGF0YXNldC5hbHRUZXh0LnNwbGl0KCd8Jyk7XG4gICAgICAgIHZhciBpdGVtQ29sb3IgPSBpdGVtQWx0U3BsaXQubGVuZ3RoID4gMSA/IGl0ZW1BbHRTcGxpdFsxXS50cmltKCkgOiBmYWxzZTtcbiAgICAgICAgZ3JpZEl0ZW0uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZScsIGl0ZW1Db2xvciAmJiBpdGVtQ29sb3IgIT09IHZhcmlhbnRDb2xvcik7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gX2NsYXNzMztcbn0oIC8qI19fUFVSRV9fKi9fd3JhcE5hdGl2ZVN1cGVyKEhUTUxFbGVtZW50KSkpOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/views/snippets/product-gallery/product-gallery.js\n");

/***/ })

/******/ });